<!doctype html>
<html lang="en">  
<head>
  <meta charset="utf-8">
  <title>Mozilla Cryptography Class</title>
  <link rel="stylesheet" href="css/reveal.css">
  <link rel="stylesheet" href="css/theme/mozilla.css" id="theme">
  <link rel="stylesheet" href="css/crypto-presentation.css">
  <script src="lib/js/head.min.js"></script>
  <script src="js/reveal.js"></script>
</head>
 
<body>
  <div class="reveal">
    <div class="slides">
      <section>
        <img src="images/first-party/mozilla_wordmark.svg" style="background: none; border: 0; box-shadow: none; width: 50%;">
      </section>

      <section>
        <h2>Intro to Cryptography</h2>
        <div style="font-size: .6em; font-style: oblique; margin-top: 100px;"><a href="https://github.com/marumari/crypto-presentation/tree/gh-pages">Fork me on GitHub!</a></div>
      </section>

      <section>
        <h3 class="pre-box-row">GET /April%20King HTTP/1.1</h3>
        <p>Information Security Engineer<br />Mozilla Corporation</p>
        <p style="font-size: smaller;"><a href="mailto:april@mozilla.com">april@mozilla.com</a> &mdash; <a href="https://github.com/marumari/">gh/marumari</a> &mdash; <a href="https://twitter.com/aprilmpls">@aprilmpls</a></p>
      </section>
 
      <section>
        <h2>Learning Objectives</h2>
        <ul>
          <li class="fragment">History and purpose of cryptography</li>
          <li class="fragment">Build a solid understanding of cryptographic primitives</li>
          <li class="fragment">Learn how cryptographic primitives are combined to make a complete cryptographic system</li>
          <li class="fragment">Realize some of the many ways you can screw up when writing your own cryptography or secure communication protocols</li>
        </ul>
      </section>

      <section>
        <h2>Ignorance Objectives</h2>
        <ul>
          <li>Writing your own cryptography</li>
        </ul>
      </section>

      <section>
        <h3>What is cryptography?</h3>
        <p class="left">Cryptography is the practice and study of secure communications in the presence of third parties. It does this by providing three primary security guarantees:</p>
        <ul>
          <li class="fragment"><strong>Confidentiality</strong>
            <ul>
              <li><em>Can I keep my data from being decrypted and read?</em></li>
            </ul>
          </li>

          <li class="fragment"><strong>Integrity</strong>
            <ul>
              <li><em>Has my data been tampered with?</em></li>
            </ul>
          </li>

          <li class="fragment"><strong>Authenticity</strong>
            <ul>
              <li><em>Is the party I'm conversing with who they claim to be?</em></li>
            </ul>
          </li>
        </ul>
      </section>

      <section>
        <p><img src="images/first-party/alice_and_bob.svg" style="background: none; border: 0; box-shadow: none; margin: 0;" height="350" /></p>
        <p>Most importantly, cryptography is a story about a couple of truly lovely people by the name of Alice and Bob.</p>
      </section>

      <section>
        <p><img src="images/third-party/alice_and_bob_private_conversation.svg" style="background: none; border: 0; box-shadow: none; margin: 0;" height="450" /></p>
        <p>They just want to have a private, secure<br />conversation over an insecure network.</p>
      </section>

      <section>
        <p><em>So let's make their wish come true!</em></p>
      </section>

      <!-- Begin history -->
      <section>
        <h2>Cryptography History</h2>
        <p><em>The way way back machine!</em></p>
        <aside class="notes">&hellip; to take a look at the old, busted stuff.</aside>
      </section>

      <section>
        <h2>Origin Story</h2>
        <p>&hellip; dates back to approximately 1500 BCE</p>
        <dl class="fragment" style="margin-top: 2rem;">
          <dt>Original goal of cryptography:</dt>
          <dd>Keeping messages confidential, for the purposes of commercial trade secrets and military communications</dd>
        </dl>
      </section>

      <section>
        <h2>Historic Cryptography</h2>
        <dl>
          <dt>Substitution ciphers</dt>
          <dd>Characters in plaintext are replaced with other characters</dd>
          <dt>Transposition ciphers</dt>
          <dd>Characters in plaintext are rearranged</dd>
        </dl>
        <p class="fragment" style="text-align: left;">These ciphers comprised the entirety of cryptography up until the beginning of modern cryptography with World War II and the creation of the Enigma machine.</p>
      </section>

      <section>
        <h2>Caesar Cipher</h2>
        <ul>
          <li>Shift each letter in message three characters to the left</li>
        </ul>
        <table class="substitution">
          <tr>
            <td>A</td>
            <td>B</td>
            <td>C</td>
            <td>D</td>
            <td>E</td>
            <td>F</td>
            <td>G</td>
            <td>H</td>
            <td>I</td>
            <td>J</td>
            <td>K</td>
            <td>L</td>
            <td class="fragment highlight-current-red mapping" data-fragment-index="1">M</td>
            <td>N</td>
            <td class="fragment highlight-current-red mapping" data-fragment-index="2">O</td>
            <td>P</td>
            <td>Q</td>
            <td>R</td>
            <td>S</td>
            <td>T</td>
            <td>U</td>
            <td>V</td>
            <td>W</td>
            <td>X</td>
            <td>Y</td>
            <td class="fragment highlight-current-red mapping" data-fragment-index="3">Z</td>
          </tr>
          <tr>
            <td>X</td>
            <td>Y</td>
            <td>Z</td>
            <td>A</td>
            <td>B</td>
            <td>C</td>
            <td>D</td>
            <td>E</td>
            <td>F</td>
            <td>G</td>
            <td>H</td>
            <td>I</td>
            <td class="fragment highlight-current-red mapping" data-fragment-index="1">J</td>
            <td>K</td>
            <td class="fragment highlight-current-red mapping" data-fragment-index="2">L</td>
            <td>M</td>
            <td>N</td>
            <td>O</td>
            <td>P</td>
            <td>Q</td>
            <td>R</td>
            <td>S</td>
            <td>T</td>
            <td>U</td>
            <td>V</td>
            <td class="fragment highlight-current-red mapping" data-fragment-index="3">W</td>
          </tr>
        </table>
        <p>Example:
          <div class="pre-box-container">
            <div class="pre-box-row">
              <span class="fragment highlight-current-red mapping" data-fragment-index="1">M</span>
              <span class="fragment highlight-current-red mapping" data-fragment-index="2">O</span>
              <span class="fragment highlight-current-red mapping" data-fragment-index="3">Z</span>
              ILLA IS MY DINOSAUR
            </div>
            <div class="pre-box-row">
              <span class="fragment highlight-current-red mapping" data-fragment-index="1">J</span>
              <span class="fragment highlight-current-red mapping" data-fragment-index="2">L</span>
              <span class="fragment highlight-current-red mapping" data-fragment-index="3">W</span>
              FIIX FP JV AFKLPXRO
            </div>
          </div>
        </p>
      </section>

      <section>
        <h2>Conceptualize</h2>
        <dl>
          <dt>Algorithm</dt>
          <dd>Replace each letter with the letter three characters to the left</dd>
          <dt>Cipher</dt>
          <dd>Caesar (rotational) cipher, a substitution cipher</dd>
          <dt>Key</dt>
          <dd>A 23 (or -3) letter rotation</dd>
          <dt>Key space</dt>
          <dd>26, since you have 26 possible rotation possibilities</dd>
        </dl>
      <p class="fragment friendly-aside"><em>That said, rotating 26 characters means that effectively<br />no encryption is done. 26 is a weak key!</em></p>
      </section>

      <section>
        <h2>Substitution Cipher</h2>
        <ul>
          <li>Instead of shifting, match each letter to another letter randomly</li>
        </ul>
        <table class="substitution">
          <tr>
            <td>A</td>
            <td>B</td>
            <td>C</td>
            <td>D</td>
            <td>E</td>
            <td>F</td>
            <td>G</td>
            <td>H</td>
            <td>I</td>
            <td>J</td>
            <td>K</td>
            <td>L</td>
            <td class="fragment highlight-current-red mapping" data-fragment-index="1">M</td>
            <td>N</td>
            <td class="fragment highlight-current-red mapping" data-fragment-index="2">O</td>
            <td>P</td>
            <td>Q</td>
            <td>R</td>
            <td>S</td>
            <td>T</td>
            <td>U</td>
            <td>V</td>
            <td>W</td>
            <td>X</td>
            <td>Y</td>
            <td class="fragment highlight-current-red mapping" data-fragment-index="3">Z</td>
          </tr>
          <tr>
            <td>G</td>
            <td>J</td>
            <td>Z</td>
            <td>X</td>
            <td>C</td>
            <td>K</td>
            <td>W</td>
            <td>U</td>
            <td>F</td>
            <td>E</td>
            <td>S</td>
            <td>Q</td>
            <td class="fragment highlight-current-red mapping" data-fragment-index="1">D</td>
            <td>L</td>
            <td class="fragment highlight-current-red mapping" data-fragment-index="2">I</td>
            <td>R</td>
            <td>P</td>
            <td>A</td>
            <td>O</td>
            <td>M</td>
            <td>Y</td>
            <td>T</td>
            <td>V</td>
            <td>H</td>
            <td>B</td>
            <td class="fragment highlight-current-red mapping" data-fragment-index="3">N</td>
          </tr>
        </table>
        <p>Example:
          <div class="pre-box-container">
            <div class="pre-box-row">
              <span class="fragment highlight-current-red mapping" data-fragment-index="1">M</span>
              <span class="fragment highlight-current-red mapping" data-fragment-index="2">O</span>
              <span class="fragment highlight-current-red mapping" data-fragment-index="3">Z</span>
              ILLA IS MY DINOSAUR
            </div>
            <div class="pre-box-row">
              <span class="fragment highlight-current-red mapping" data-fragment-index="1">D</span>
              <span class="fragment highlight-current-red mapping" data-fragment-index="2">I</span>
              <span class="fragment highlight-current-red mapping" data-fragment-index="3">N</span>
              FQQG FO DB XFLIOGYA
          </div>
        </p>
      </section>

      <section>
        <h2>Transposition Cipher</h2>
        <ul>
          <li>Encryption involves rearranging the plaintext to produce ciphertext</li>
          <li>Decryption simply involves reversing the rearrangement</li>
        </ul>
        <p class="fragment" style="font-size: smaller;"><em>Let's take a look at a simple example...</em></p>
      </section>

      <section>
        <h2>Route Cipher</h2>
        <dl style="font-size: .9em;">
          <dt>Key</dt>
          <dd>Grid is five characters wide, write text from upper left rightward. Route from lower right and spiral upward.</dd>
        </dl>
        <p>Canonicalize:</p>
        <pre style="font-size: 1em; text-align: center;"><span class="fragment highlight-red mapping" data-fragment-index="2">MOZI</span><span class="fragment highlight-red mapping" data-fragment-index="1">L</span>
<span class="fragment highlight-red mapping" data-fragment-index="3">L</span><span class="fragment highlight-red mapping" data-fragment-index="5">AI</span><span class="fragment highlight-red mapping" data-fragment-index="4">S</span><span class="fragment highlight-red mapping" data-fragment-index="1">M</span>
<span class="fragment highlight-red mapping" data-fragment-index="3">Y</span><span class="fragment highlight-red mapping" data-fragment-index="6">DI</span><span class="fragment highlight-red mapping" data-fragment-index="4">N</span><span class="fragment highlight-red mapping" data-fragment-index="1">O</span>
<span class="fragment highlight-red mapping" data-fragment-index="3">S</span><span class="fragment highlight-red mapping" data-fragment-index="4">AUR</span> 
</pre>
        <p>Example:</p>
        <div class="pre-box-container">
          <div class="pre-box-row">
            <span class="fragment highlight-red mapping" data-fragment-index="1">MOZ</span>
            <span class="fragment highlight-red mapping" data-fragment-index="2">ILLA</span>
            &nbsp;
            <span class="fragment highlight-red mapping" data-fragment-index="3">IS M</span>
            <span class="fragment highlight-red mapping" data-fragment-index="4">Y DINO</span>
            <span class="fragment highlight-red mapping" data-fragment-index="5">SA</span>
            <span class="fragment highlight-red mapping" data-fragment-index="6">UR</span>
          </div>
          <div class="pre-box-row">
            <span class="fragment highlight-red mapping" data-fragment-index="1">OML</span>
            <span class="fragment highlight-red mapping" data-fragment-index="2">IZOM</span> 
            &nbsp;
            <span class="fragment highlight-red mapping" data-fragment-index="3">LY S</span>
            <span class="fragment highlight-red mapping" data-fragment-index="4">A URNS</span>
            <span class="fragment highlight-red mapping" data-fragment-index="5">IA</span>
            <span class="fragment highlight-red mapping" data-fragment-index="6">DI</span>
          </div>
        </div>
      </section>

      <section>
        <h3>So why might these simple<br />ciphers not be secure?</h3>
      </section>

      <section style="padding-top: 0;">
        <h3>Frequency Analysis</h3>
        <div>
          <img src="images/third-party/English_letter_frequency.svg" style="background: none; border: 0; box-shadow: none" height="450">
        </div>
        <p>It turns out that not every letter in the<br />English language appears equally as often</p>
      </section>

      <section style="padding-top: 0;">
        <h3>Frequency Analysis</h3>
        <div>
          <img src="images/third-party/English_letter_frequency_perfect_crypto.svg" style="background: none; border: 0; box-shadow: none" height="450">
        </div>
        <p>Ideally, each letter should appear at the same frequency</p>
      </section>

      <section>
        <h2>Frequency Analysis</h2>
        <ul>
          <li>Letters that appear more frequently in a language will appear more frequently in the ciphertext</li>
          <li class="fragment">Since <span class="green mono">'E'</span> is the most common letter in English, whatever it maps to will be the most common letter in the ciphertext</li>
          <li class="fragment">This leads to what is known as a <strong>ciphertext-only attack</strong>, where someone is able to deduce your plaintext from the ciphertext <em>without</em> knowing your key</li>
        </ul>
      </section>

      <section>
        <h3><em>Don't panic!</em></h3>
      </section>

      <section>
        <h2>Vigenère Cipher</h2>
        <ul>
          <li>A type of cipher known as a polyalphabetic cipher</li>
          <li>First described in the mid 1500s, it was considered the "indecipherable cipher" for over 300 years</li>
          <li>Defeated frequency analysis and eventually led to the development of the one-time pad</li>
        </ul>
      </section>

      <section data-transition="slide-in fade-out" style="padding-top: 0;">
        <h3>Vigenère Cipher</h3>
        <div>
          <img src="images/third-party/Vigenere_square_updated.svg" class="plain" height="400">
        </div>
        <p>
          <div class="pre-box-container">
            <div class="pre-box-row">Plaintext:           &nbsp;MOZILLA IS MY DINOSAUR</div>
            <div class="pre-box-row">Keyword: &nbsp;&nbsp;&nbsp;WHIMSYW HI MS YWHIMSYW</div>
            <div class="pre-box-row">Ciphertext:                IVHUDJW PA YQ AEUWESSN</div>
          </div>
        </p>
      </section>

      <section data-transition="fade" data-transition-speed="fast" style="padding-top: 0;">
        <h3>Vigenère Cipher</h3>
        <div>
          <img src="images/third-party/Vigenere_square_updated_fragment2.svg" class="plain" height="400">
        </div>
        <p>
          <div class="pre-box-container">
            <div class="pre-box-row">Plaintext:&nbsp;&nbsp;          <span class="mapping red">M</span>OZILLA&nbsp;IS&nbsp;MY&nbsp;DINOSAUR</div>
            <div class="pre-box-row">Keyword:&nbsp;&nbsp;&nbsp;&nbsp;<span class="mapping red">W</span>HIMSYW&nbsp;HI&nbsp;MS&nbsp;YWHIMSYW</div>
            <div class="pre-box-row">Ciphertext:&nbsp;               <span class="mapping red">I</span>VHUDJW&nbsp;PA&nbsp;YQ&nbsp;AEUWESSN</div>
          </div>
        </p>
      </section>

      <section data-transition="fade" data-transition-speed="fast" style="padding-top: 0;">
        <h3>Vigenère Cipher</h3>
        <div>
          <img src="images/third-party/Vigenere_square_updated_fragment3.svg" class="plain" height="400">
        </div>
        <p>
        <p>
          <div class="pre-box-container">
            <div class="pre-box-row">Plaintext:&nbsp;                M<span class="mapping red">O</span>ZILLA&nbsp;IS&nbsp;MY&nbsp;DINOSAUR</div>
            <div class="pre-box-row">Keyword:&nbsp;&nbsp;&nbsp;&nbsp;W<span class="mapping red">H</span>IMSYW&nbsp;HI&nbsp;MS&nbsp;YWHIMSYW</div>
            <div class="pre-box-row">Ciphertext:                     I<span class="mapping red">V</span>HUDJW&nbsp;PA&nbsp;YQ&nbsp;AEUWESSN</div>
          </div>
        </p>
      </section>

      <section data-transition="fade" data-transition-speed="fast" style="padding-top: 0;">
        <h3>Vigenère Cipher</h3>
        <div>
          <img src="images/third-party/Vigenere_square_updated_fragment4.svg" class="plain" height="400">
        </div>
        <p>
          <div class="pre-box-container">
            <div class="pre-box-row">Plaintext:&nbsp;                MO<span class="mapping red">Z</span>ILLA&nbsp;IS&nbsp;MY&nbsp;DINOSAUR</div>
            <div class="pre-box-row">Keyword:&nbsp;&nbsp;&nbsp;&nbsp;WH<span class="mapping red">I</span>MSYW&nbsp;HI&nbsp;MS&nbsp;YWHIMSYW</div>
            <div class="pre-box-row">Ciphertext:                     IV<span class="mapping red">H</span>UDJW&nbsp;PA&nbsp;YQ&nbsp;AEUWESSN</div>
          </div>
        </p>
      </section>

      <section data-transition="fade-in slide-out" style="padding-top: 0;">
        <h3>Vigenère Cipher</h3>
        <div>
          <img src="images/third-party/Vigenere_square_updated_fragment5.svg" class="plain" height="400">
        </div>
        <p>
          <div class="pre-box-container">
            <div class="pre-box-row">Plaintext:&nbsp;                MOZI<span class="mapping red">L</span><span class="mapping blue">L</span>A&nbsp;IS&nbsp;MY&nbsp;DINOSAUR</div>
            <div class="pre-box-row">Keyword:&nbsp;&nbsp;&nbsp;&nbsp;WHIM<span class="mapping red">S</span><span class="mapping blue">Y</span>W&nbsp;HI&nbsp;MS&nbsp;YWHIMSYW</div>
            <div class="pre-box-row">Ciphertext:                     IVHU<span class="mapping red">D</span><span class="mapping blue">J</span>W&nbsp;PA&nbsp;YQ&nbsp;AEUWESSN</div>
          </div>
        </p>
        <p><em>Two consecutive "L"s encrypt to different outputs</em></p>
      </section>

      <section>
        <h3>Vigenère Cipher</h3>
        <ul>
          <li>Turns out, the Vigenère cipher is completely busted</li>
          <li class="fragment" data-fragment-index="1">Sometimes patterns in the plaintext appear in the ciphertext</li>
        </ul>
        <div class="fragment pre-box-container" data-fragment-index="1">
          <div class="pre-box-row">
            P: MOZILLA IS MY DINOSAUR A
            <span class="mapping red">N</span>
            <span class="mapping blue">D</span>
            &nbsp;FRIE
            <span class="mapping red">N</span>
            <span class="mapping blue">D</span>
          </div>
          <div class="pre-box-row">
            K: WHIMSYW HI MS YWHIMSYW H
            <span class="mapping red">I</span>
            <span class="mapping blue">M</span>&nbsp;SYWH
            <span class="mapping red">I</span>
            <span class="mapping blue">M</span>
          </div>
          <div class="pre-box-row">
            C: IVHUDJW PA YQ AEUWESSN H
            <span class="mapping red">V</span>
            <span class="mapping blue">P</span>
            &nbsp;XPEL
            <span class="mapping red">V</span>
            <span class="mapping blue">P</span>
          </div>
        </div>
      </section>

      <section>
        <h3>Breaking Vigenère</h3>
        <ul>
          <li>Iterate through each possible key length</li>
          <li class="fragment" data-fragment-index="1">Divide the ciphertext into chunks of that length (6)</li>
        </ul>
        <div class="fragment pre-box-container" data-fragment-index="1">
          <div class="fragment pre-box-row" data-fragment-index="1">
            <span                >C:</span>
            &nbsp;
            <span class="green"  >I</span>
            <span class="blue"   >V</span>
            <span class="purple" >H</span>
            <span class="red"    >U</span>
            <span class="pink"   >D</span>
            <span class="orange" >J</span>
            <span class="green"  >W</span>
            &nbsp;
            <span class="blue"   >P</span>
            <span class="purple" >A</span>
            &nbsp;
            <span class="red"    >Y</span>
            <span class="pink"   >Q</span>
            &nbsp;
            <span class="orange" >A</span>
            <span class="green"  >E</span>
            <span class="blue"   >U</span>
            <span class="purple" >W</span>
            <span class="red"    >E</span>
            <span class="pink"   >S</span>
            <span class="orange" >S</span>
            <span class="green"  >N</span>
            &nbsp;
            <span class="blue"   >H</span>
            <span class="purple" >V</span>
            <span class="red"    >P</span>
            &nbsp;
            <span class="pink"   >X</span>
            <span class="orange" >P</span>
            <span class="green"  >E</span>
            <span class="blue"   >L</span>
            <span class="purple" >V</span>
            <span class="red"    >P</span>
          </div>
        </div>

        <ul class="fragment" data-fragment-index="2">
          <li>Each column is a simple rotation cipher; use frequency analysis to discover the rotation</li>
        </ul>

        <div class="fragment pre-box-container" data-fragment-index="2">
          <div class="fragment pre-box-row" data-fragment-index="2">
            <span                >C:</span>
            &nbsp;
            <span class="green"  >I</span>
            <span class="blue"   >V</span>
            <span class="purple" >H</span>
            <span class="red"    >U</span>
            <span class="pink"   >D</span>
            <span class="orange" >J</span>
            <span class="green"  >W</span>
            &nbsp;
            <span class="blue"   >P</span>
            <span class="purple" >A</span>
            &nbsp;
            <span class="red"    >Y</span>
            <span class="pink"   >Q</span>
            &nbsp;
            <span class="orange" >A</span>
            <span class="green"  >E</span>
            <span class="blue"   >U</span>
            <span class="purple" >W</span>
            <span class="red"    >E</span>
            <span class="pink"   >S</span>
            <span class="orange" >S</span>
            <span class="green"  >N</span>
            &nbsp;
            <span class="blue"   >H</span>
            <span class="purple" >V</span>
            <span class="red"    >P</span>
            &nbsp;
            <span class="pink"   >X</span>
            <span class="orange" >P</span>
            <span class="green"  >E</span>
            <span class="blue"   >L</span>
            <span class="purple" >V</span>
            <span class="red"    >P</span>
          </div>
          <div class="fragment pre-box-row" data-fragment-index="2">
            <span                                         >K:</span>
            &nbsp;
            <span class="fragment" data-fragment-index="2">W</span>
            <span class="fragment" data-fragment-index="4">H</span>
            <span class="fragment" data-fragment-index="5">I</span>
            <span class="fragment" data-fragment-index="6">M</span>
            <span class="fragment" data-fragment-index="7">S</span>
            <span class="fragment" data-fragment-index="8">Y</span>
            <span class="fragment" data-fragment-index="2">W</span>
            &nbsp;
            <span class="fragment" data-fragment-index="4">H</span>
            <span class="fragment" data-fragment-index="5">I</span>
            &nbsp;
            <span class="fragment" data-fragment-index="6">M</span>
            <span class="fragment" data-fragment-index="7">S</span>
            &nbsp;
            <span class="fragment" data-fragment-index="8">Y</span>
            <span class="fragment" data-fragment-index="2">W</span>
            <span class="fragment" data-fragment-index="4">H</span>
            <span class="fragment" data-fragment-index="5">I</span>
            <span class="fragment" data-fragment-index="6">M</span>
            <span class="fragment" data-fragment-index="7">S</span>
            <span class="fragment" data-fragment-index="8">Y</span>
            <span class="fragment" data-fragment-index="2">W</span>
            &nbsp;
            <span class="fragment" data-fragment-index="4">H</span>
            <span class="fragment" data-fragment-index="5">I</span>
            <span class="fragment" data-fragment-index="6">M</span>
            &nbsp;
            <span class="fragment" data-fragment-index="7">S</span>
            <span class="fragment" data-fragment-index="8">Y</span>
            <span class="fragment" data-fragment-index="2">W</span>
            <span class="fragment" data-fragment-index="4">H</span>
            <span class="fragment" data-fragment-index="5">I</span>
            <span class="fragment" data-fragment-index="6">M</span>
          </div>
          <div class="fragment pre-box-row" data-fragment-index="3">
            <span                >P:</span>
            &nbsp;
            <span class="fragment green"  data-fragment-index="3">M</span>
            <span class="fragment blue"   data-fragment-index="4">O</span>
            <span class="fragment purple" data-fragment-index="5">Z</span>
            <span class="fragment red"    data-fragment-index="6">I</span>
            <span class="fragment pink"   data-fragment-index="7">L</span>
            <span class="fragment orange" data-fragment-index="8">L</span>
            <span class="fragment green"  data-fragment-index="3">A</span>
            &nbsp;
            <span class="fragment blue"   data-fragment-index="4">I</span>
            <span class="fragment purple" data-fragment-index="5">S</span>
            &nbsp;
            <span class="fragment red"    data-fragment-index="6">M</span>
            <span class="fragment pink"   data-fragment-index="7">Y</span>
            &nbsp;
            <span class="fragment orange" data-fragment-index="8">D</span>
            <span class="fragment green"  data-fragment-index="3">I</span>
            <span class="fragment blue"   data-fragment-index="4">N</span>
            <span class="fragment purple" data-fragment-index="5">O</span>
            <span class="fragment red"    data-fragment-index="6">S</span>
            <span class="fragment pink"   data-fragment-index="7">A</span>
            <span class="fragment orange" data-fragment-index="8">U</span>
            <span class="fragment green"  data-fragment-index="3">R</span>
            &nbsp;
            <span class="fragment blue"   data-fragment-index="4">A</span>
            <span class="fragment purple" data-fragment-index="5">N</span>
            <span class="fragment red"    data-fragment-index="6">D</span>
            &nbsp;
            <span class="fragment pink"   data-fragment-index="7">F</span>
            <span class="fragment orange" data-fragment-index="8">R</span>
            <span class="fragment green"  data-fragment-index="3">I</span>
            <span class="fragment blue"   data-fragment-index="4">E</span>
            <span class="fragment purple" data-fragment-index="5">N</span>
            <span class="fragment red"    data-fragment-index="6">D</span>
          </div>
        </div>

        <ul class="fragment" data-fragment-index="3" style="font-size: smaller;">
            <li>To reverse a rotation of 22 (W), move the ciphertext either -22 or +4. Repeat this process for every column, and we're back to the original message.<br />
            <span class="fragment" data-fragment-index="4">H: -8 (+18)</span>
            <span class="fragment" data-fragment-index="5">• I: -9 (+17)</span>
            <span class="fragment" data-fragment-index="6">• M: -13 (+13)</span>
            <span class="fragment" data-fragment-index="7">• S: -19 (+7)</span>
            <span class="fragment" data-fragment-index="8">• Y: -24 (+2)</span>
          </li>
        </ul>
      </section>

      <section>
        <h3>Let's take this one step further</h3>
        <p><em>What if the key was exactly as long as the message?</em></p>
        <p style="font-size: smaller;">(and also totally random)</p>
      </section>

      <section>
        <h2>One-time Pad</h2>
        <p><em>Congratulations! You've just invented the only truly unbreakable form of cryptography.</em></p>
        <ul>
          <li>If the key is at least as long as the message and truly random, you can combine (XOR) the key and the message to create a message that can never be decrypted</li>
        </ul>
      </section>

      <section>
        <h2>XOR (exclusive or)</h2>
        <p class="left">XOR, sometimes written ⊕, is an operator that outputs true (1) if the inputs differ and outputs false (0) if they are the same.</p>
        <ul class="fragment" data-fragment-index="1">
          <li class="fragment" data-fragment-index="1">0 ⊕ 0 == 0, since the inputs are the same</li>
          <li class="fragment" data-fragment-index="2">0 ⊕ 1 == 1, since the inputs are different</li>
          <li class="fragment" data-fragment-index="3">1 ⊕ 0 == 1, since the inputs are different</li>
          <li class="fragment" data-fragment-index="4">1 ⊕ 1 == 0, since the inputs are the same</li>
        </ul>
      </section>

      <section>
        <h3>XOR (exclusive or)</h3>
        <table>
          <tr>
            <td><span class="fragment highlight-current-red" data-fragment-index="1">Message:</span></td>
            <td><span class="fragment highlight-current-red" data-fragment-index="1">1</span></td>
            <td><span class="fragment highlight-current-red" data-fragment-index="1">1</span></td>
            <td><span class="fragment highlight-current-red" data-fragment-index="1">1</span></td>
            <td><span class="fragment highlight-current-red" data-fragment-index="1">1</span></td>
            <td><span class="fragment highlight-current-red" data-fragment-index="1">1</span></td>
            <td><span class="fragment highlight-current-red" data-fragment-index="1">1</span></td>
            <td><span class="fragment highlight-current-red" data-fragment-index="1">1</span></td>
            <td><span class="fragment highlight-current-red" data-fragment-index="1">1</span></td>
            <td><span class="fragment highlight-current-red" data-fragment-index="1">1</span></td>
            <td><span class="fragment highlight-current-red" data-fragment-index="1">1</span></td>
            <td><span class="fragment highlight-current-red" data-fragment-index="1">1</span></td>
            <td><span class="fragment highlight-current-red" data-fragment-index="1">1</span></td>
          </tr>
          <tr>
            <td><span class="fragment highlight-current-red" data-fragment-index="2">Key:</span></td>
            <td><span class="fragment highlight-current-red" data-fragment-index="2">0</span></td>
            <td><span class="fragment highlight-current-red" data-fragment-index="2">1</span></td>
            <td><span class="fragment highlight-current-red" data-fragment-index="2">0</span></td>
            <td><span class="fragment highlight-current-red" data-fragment-index="2">0</span></td>
            <td><span class="fragment highlight-current-red" data-fragment-index="2">1</span></td>
            <td><span class="fragment highlight-current-red" data-fragment-index="2">0</span></td>
            <td><span class="fragment highlight-current-red" data-fragment-index="2">0</span></td>
            <td><span class="fragment highlight-current-red" data-fragment-index="2">1</span></td>
            <td><span class="fragment highlight-current-red" data-fragment-index="2">1</span></td>
            <td><span class="fragment highlight-current-red" data-fragment-index="2">1</span></td>
            <td><span class="fragment highlight-current-red" data-fragment-index="2">0</span></td>
            <td><span class="fragment highlight-current-red" data-fragment-index="2">1</span></td>
          </tr>
          <tr>
            <td><span class="fragment highlight-current-red" data-fragment-index="3">Output:</span></td>
            <td><span class="fragment highlight-current-red" data-fragment-index="3">1</span></td>
            <td><span class="fragment highlight-current-red" data-fragment-index="3">0</span></td>
            <td><span class="fragment highlight-current-red" data-fragment-index="3">1</span></td>
            <td><span class="fragment highlight-current-red" data-fragment-index="3">1</span></td>
            <td><span class="fragment highlight-current-red" data-fragment-index="3">0</span></td>
            <td><span class="fragment highlight-current-red" data-fragment-index="3">1</span></td>
            <td><span class="fragment highlight-current-red" data-fragment-index="3">1</span></td>
            <td><span class="fragment highlight-current-red" data-fragment-index="3">0</span></td>
            <td><span class="fragment highlight-current-red" data-fragment-index="3">0</span></td>
            <td><span class="fragment highlight-current-red" data-fragment-index="3">0</span></td>
            <td><span class="fragment highlight-current-red" data-fragment-index="3">1</span></td>
            <td><span class="fragment highlight-current-red" data-fragment-index="3">0</span></td>
          </tr>
        </table>
        <p class="left">XOR has the special property that its output is as random as the most random input</p>
        <ul>
          <li class="fragment highlight-current-red" data-fragment-index="1">Take non-random message</li>
          <li class="fragment highlight-current-red" data-fragment-index="2">Combine with random key</li>
          <li class="fragment highlight-current-red" data-fragment-index="3">The output is as random as the key</li>
        </ul>
        <p class="fragment friendly-aside" data-fragment-index="4">If your key is a one-time pad, then your message can never be broken!</p>
        <aside class="notes">Note how XOR has no bias towards 0 or 1, as long as one of the inputs has no bias.</aside>
      </section>

      <section style="font-size: .95em; padding-top: 0;">
        <h3>One-time Pad</h3>
        <p class="left">So why don't we use one-time pads for all of our encryption, if it's so unbreakable?</p>
        <ul>
          <li class="fragment">First, the key needs to be at least as long as your message.  If your message is 5GB, then your key also needs to be 5GB.</li>
          <li class="fragment">Also, the key can only be used once.  Key reuse &mdash; like we saw in the Vigenère cipher &mdash; reveals information about all your previous messages.</li>
        </ul>
        <p class="left fragment">The impracticality of having extremely long keys combined with the key reuse requirements makes the OTP infeasible for much real-world use.</p>
        <p class="fragment friendly-aside">Anyone selling them is likely a <a href="https://www.schneier.com/crypto-gram/archives/1999/0215.html#snakeoil">snake oil salesperson</a>.</p>
        <aside class="notes">
          This is because M1 ⊕ K ⊕ M2 ⊕ K == M1 ⊕ M2. Also, if you can securely transmit a 5GB key, then why not submit the message?
        </aside>
      </section>

      <section>
        <h2>Modern Cryptography</h2>
      </section>

      <section>
        <h3>Symmetric-key cryptography</h3>
        <p class="left">Symmetric-key cryptography, like historic cryptography, uses the same key for both <em>encryption</em> and <em>decryption</em>:</p>
        <img src="images/first-party/symmetric-key.svg" style="background: none; border: 0; box-shadow: none;" />
        <p class="fragment left">Here, plaintext is being encrypted by a key into ciphertext, and then decrypted with that same key into the original plaintext.</p>
      </section>

      <section>
        <h2>Keys</h2>
        <p class="left">Remember that in a proper cryptosystem, the key is the only thing that keeps your data confidential. As such, keys should be:</p>
        <ul>
          <li class="fragment">Kept secure and be deleted as soon as they are no longer needed</li>
          <li class="fragment">Independent from any past or future key</li>
          <li class="fragment">Chosen from safe values in the key space</li>
        </ul>
      </section>

      <section>
        <h2>Key space</h2>
        <p class="left">When we talk about keys, we often say "128-bit keys" or "256-bit keys." What does that mean?</p>
        <ul>
          <li class="fragment">"128-bit" refers to the size of the <em>key space</em>. Key space is simply the number of possible keys.</li>
          <li class="fragment">Since a bit can have two values (0 or 1), a 128-bit key space has 2<sup>128</sup> possible keys.</li>
        </ul>
        <p class="fragment friendly-aside">How big is 2<sup>128</sup>?</p>
        <p class="fragment friendly-aside left">If a single key was the size of a grain of sand, the key space would be 31x the size of Jupiter!  310 bits gets you up to the size of the known universe.</p>
        <aside class="notes">
          The Caesar cipher has a keyspace of 26, which equates to only 4.7 bits.
        </aside>
      </section>

      <section>
        <h3>Symmetric-key cryptography</h3>
        <ul>
          <li>Advantages
            <ul>
              <li>Computationally very fast and simple</li>
              <li class="fragment" data-fragment-index="1">Keys are small (typically 128 to 256 bits)</li>
              <li class="fragment" data-fragment-index="2">Can provide assurances about authenticity and integrity with the use of additional constructs</li>
            </ul>
          </li>
          <li class="fragment" data-fragment-index="3">Disadvantages
            <ul>
              <li class="fragment" data-fragment-index="3">Key management is difficult, as each party needs a copy of the key to encrypt or decrypt</li>
            </ul>
          </li>
        </ul>
        <p class="fragment">Due to its speed, symmetric-key cryptography is the primary form of encryption for bulk encryption.</p>
      </section>

      <section>
        <h3>Symmetric-key cryptography</h3>
        <table class="centered">
          <tr>
            <th>Cipher</th>
            <th>Key size</th>
            <th>Type</th>
          </tr>
          <tr>
            <td>AES</td>
            <td>128<span class="light-gray">, 192, or </span>256 bits</td>
            <td>Block</td>
          </tr>
          <tr>
            <td>ChaCha20</td>
            <td>256 bits</td>
            <td>Stream</td>
          </tr>
          <tr class="light-gray">
            <td>Camellia</td>
            <td>128, 192, or 256 bits</td>
            <td>Block</td>
          </tr>
          <tr class="light-gray">
            <td>3DES</td>
            <td>192 bits</td>
            <td>Block</td>
          </tr>
          <tr class="light-gray">
            <td>RC4</td>
            <td>128 bits</td>
            <td>Stream</td>
          </tr>
          <tr class="light-gray">
            <td>Twofish</td>
            <td>128, 192, or 256 bits</td>
            <td>Block</td>
          </tr>
        </table>
        <p class="friendly-aside">Mozilla <a href="https://wiki.mozilla.org/Security/Server_Side_TLS">recommends</a> AES with 128 or 256-bit keys or ChaCha20.<br />When in doubt, contact us!</p>
      </section>

      <section>
        <h3>Stream ciphers</h3>
          <ul>
            <li>Operate on one bit at a time</li>
            <li class="fragment">Take the <strong>key</strong>&hellip;</li>
            <li class="fragment">&hellip;plus maybe a <strong>nonce</strong>, or a number only used once&hellip;</li>
            <li class="fragment">Use these to produce a stream of bits as long as your message, known as a <strong>keystream</strong></li>
            <li class="fragment">Keystream is then XORed with the plaintext to produce the ciphertext</li>
            <li class="fragment">Like a one-time pad, the keystream must never be reused; the key/nonce must be changed with each use</li>
          </ul>

        <aside class="notes">
          A number of systems using RC4 have been broken because of long-term key reuse; see WEP and related-IV attacks
        </aside>
      </section>

      <section>
        <h3>Stream ciphers</h3>
        <img src="images/first-party/stream-cipher.svg" style="background: none; border: 0; box-shadow: none;" height="350" />
        <p class="left">The key and nonce are combined to generate a keystream, which is then XORed with the plaintext to generate the ciphertext</p>
      </section>

      <section>
        <h3>Block ciphers</h3>
        <ul>
          <li>Operate on a fixed-size block of data (usually 128 bits), unlike stream ciphers</li>
          <li class="fragment">Are the most commonly used symmetric ciphers (AES)</li>
          <li class="fragment">Require that data be padded to the length of the block size, adding complexity</li>
          <li class="fragment">A given block of data will always encrypt to the same output if you use the same inputs</li>
        </ul>
        <aside class="notes">
          Block sizes are typically 64 bits (DES, Blowfish) or 128 bits (AES, Twofish)
        </aside>
      </section>

      <section>
        <h3>Block ciphers</h3>
        <p><em>Why is it a problem that the same input<br />always encrypts to the same output?</em></p>
        <ul>
          <li class="fragment">Leaks metadata about plaintext: many protocols and file formats have a identical headers</li>
          <li class="fragment">Any patterns in the plaintext will appear in the ciphertext</li>
        </ul>
      </section>

      <section>
        <h3>Block cipher modes of operation</h3>
        <p>To solve this, all block ciphers have<br />modes of operation for their use:</p>
        <ul>
          <li class="fragment" data-fragment-index="1"><strong>Electronic Code Book (ECB):</strong> Encrypt each block independently</li>
          <li class="fragment" data-fragment-index="2"><strong>Cipher Block Chaining (CBC):</strong> Propagate information from one block to the next</li>
          <li class="fragment" data-fragment-index="3"><strong>Counter (CTR):</strong> Encrypt a counter and XOR it with the plaintext</li>
          <li class="fragment" data-fragment-index="4"><strong>Galois/Counter (GCM):</strong> Counter + integrity<sup>&dagger;</sup></li>
        </ul>
        <p class="fragment friendly-aside" data-fragment-index="4"><sup>&dagger;</sup> More later!</p>
      </section>

      <section>
        <h3>Modes matter!</h3>
        <p><img class="fragment" data-fragment-index="1" src="images/third-party/Block_mode_operation_Tux.jpg" style="height: 196px; margin: 0 auto;" /> <img class="fragment" data-fragment-index="2" src="images/third-party/Block_mode_operation_Tux_ecb.jpg" style="height: 196px; margin: 0 auto;" /> <img class="fragment" data-fragment-index="3" src="images/third-party/Block_mode_operation_Tux_secure.jpg" style="height: 196px; margin: 0 auto;" /></p>
        <ul style="font-size: .9em;">
          <li class="fragment" data-fragment-index="1">Take an image and divide it into equal-sized blocks
          <li class="fragment" data-fragment-index="2">Encrypt each block separately using a symmetric key and cipher, using the Electronic Codebook (ECB) block mode of operation</li>
          <li class="fragment" data-fragment-index="3">The encrypted message should ideally look like random noise</li>
        </ul>
        <p class="fragment friendly-aside">This is meant to scare you! Even with good<br />ciphers, you can still screw up cryptography!</p>

        <aside class="notes">
          Also note that just because the right image <em>looks</em> random doesn't mean its actually random.
        </aside>
      </section>

      <section>
        <h3>Block cipher modes of operation</h3>
        <p class="left">The various block cipher modes each provide their own benefits besides simply eliminating patterns in ciphertext</p>
        <ul>
          <li class="fragment">Allowing the use of an <strong>initialization vector</strong> (random input) or nonce so that identical plaintexts encrypt differently</li>
          <li class="fragment">Change block ciphers to function like stream ciphers, eliminating the need for padding</li>
          <li class="fragment">Increased performance through use of parallelization</li>
          <li class="fragment">Some modes, such as the recommended <a href="#/aeads">Galois/Counter Mode</a> (GCM), provide assurances about the integrity and authenticity of the encrypted block</li>
        </ul>
        <aside class="notes">Pronounced Gal-eww-wah</aside>
      </section>

      <section data-transition="slide-in fade-out" data-transition-speed="fast">
        <p><img src="images/third-party/Block_mode_operation_CTR.svg" class="plain" height="240" /></p>
        <p>This is the counter (CTR) block mode of operation</p>
        <div style="height: 6.75em;">
        </div>
      </section>

      <section data-transition="fade" data-transition-speed="fast">
        <p><img src="images/third-party/Block_mode_operation_CTR1.svg" class="plain" height="240" /></p>
        <p>This is the counter (CTR) block mode of operation</p>
        <div style="height: 6.75em;">
          <ul style="width: 100%;">
            <li class="red">Create a nonce and set your counter</li>
          </ul>
        </div>
      </section>

      <section data-transition="fade" data-transition-speed="fast">
        <p><img src="images/third-party/Block_mode_operation_CTR2.svg" class="plain" height="240" /></p>
        <p>This is the counter (CTR) block mode of operation</p>
        <div style="height: 6.75em;">
          <ul>
            <li>Create a nonce and set your counter</li>
            <li class="red">Using your key, encrypt the nonce and counter, forming a single block of the keystream</li>
          </ul>
        </div>
      </section>

      <section data-transition="fade" data-transition-speed="fast">
        <p><img src="images/third-party/Block_mode_operation_CTR3.svg" class="plain" height="240" /></p>
        <p>This is the counter (CTR) block mode of operation</p>
        <div style="height: 6.75em;">
          <ul>
            <li>Create a nonce and set your counter</li>
            <li>Using your key, encrypt the nonce and counter, forming a single block of the keystream</li>
            <li class="red">XOR one block of plaintext with that keystream block</li>
          </ul>
        </div>
      </section>

      <section data-transition="fade-in slide-out" data-transition-speed="fast">
        <p><img src="images/third-party/Block_mode_operation_CTR4.svg" class="plain" height="240" /></p>
        <p>This is the counter (CTR) block mode of operation</p>
        <div style="height: 6.75em;">
          <ul>
            <li>Create a nonce and set your counter</li>
            <li>Using your key, encrypt the nonce and counter, forming a single block of the keystream</li>
            <li>XOR one block of plaintext with that keystream block</li>
            <li class="red">Increment the counter for each successive block</li>
          </ul>
          <p class="fragment friendly-aside">The nonce must always be unique, and the counter should never loop!</p>
        </div>
      </section>

      <section>
        <p><img src="images/first-party/alice_and_bob.svg" style="background: none; border: 0; box-shadow: none; margin: 0;" height="400" /></p>
        <p>Remember Alice and Bob?</p>
        <p class="fragment">They still want to have a conversation.</p>
      </section>

      <section>
        <p><img src="images/first-party/alice_and_bob_key.svg" style="background: none; border: 0; box-shadow: none; margin: 0;" height="400" /></p>
        <p>No problem, they physically<br />meet up and exchange a symmetric key.</p>
      </section>

      <section>
        <p><img src="images/first-party/alice_and_bob_symmetric_key_crypto.svg" style="background: none; border: 0; box-shadow: none; margin: 0;" height="400" /></p>
        <p>After that, they encrypt all their messages<br />using that key, a symmetric cipher, and an<br />appropriate block mode of operation.</p>
      </section>

      <section data-transition="slide-in fade-out" data-transition-speed="slow">
        <p><img class="plain" src="images/first-party/eve.svg" height="400"></p>
        <div style="height: 3em;">
          <p>Everyone give a hearty welcome to our<br />good friend, Eve the Eavesdropper!</p>
        </div>
      </section>

      <section data-transition="fade-in slide-out" data-transition-speed="slow">
        <p><img class="plain" src="images/first-party/eve_sad.svg" height="400"></p>
        <div style="height: 3em;">
          <p>Everyone give a hearty welcome to our<br />good friend, Eve the Eavesdropper!</p>
          <p class="friendly-aside">She's disappointed by this whole symmetric-key cryptography business.</p>
        </div>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/alice_and_bob_with_eve_symmetric_key_crypto.svg" height="400"></p>
        <p>See, when Alice and Bob use symmetric-key cryptography correctly, it provides them <strong>confidentiality</strong>.</p>
        <p class="friendly-aside">Eavesdroppers like Eve can't decrypt and read their messages.</p>
      </section>

      <section>
        <p><em>But what if our attacker wasn't just<br />passively listening like Eve was?</em></p>
      </section>

      <section>
        <p><img src="images/first-party/mallory.svg" class="plain" height="400"></p>
        <p class="friendly-aside">A round of applause for Mallory, everyone!</p>
        <p class="fragment">Mallory just <strong>loves</strong> to sit in the middle<br /> of conversations and meddle with them.</p>
      </section>

      <section>
        <p><em>What if Mallory was intercepting<br />Alice and Bob's conversation?</em></p>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/tls18.svg"></p>
        <p>Mallory couldn't decrypt the ciphertext,<br />but she could still modify it.</p>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/alice_and_bob_with_mallory_decryption.svg" height="400"></p>
        <p>It might decrypt to gibberish or it might not.</p>
        <p>Either way, Bob has no way of knowing<br />that it has been tampered with.</p>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/tls18.svg"></p>
        <p>Alice and Bob have achieved confidentiality, but they haven't achieved <strong>integrity</strong> or <strong>authentication</strong>.</p>
      </section>

      <section>
        <p>What Alice and Bob need is a<br /><strong>message authentication code</strong>.</p>
      </section>

      <section>
        <p>A message authentication code provides integrity and authenticity assurances about a message.</p>
        <ul>
          <li class="fragment">Alice takes any given message<sup>&dagger;</sup> and a MAC key that she and Bob have previously exchanged</li>
          <li class="fragment">She inputs these into a function that combines them and outputs a short piece of information called a MAC</li>
          <li class="fragment">She then attaches the MAC to the ciphertext</li>
          <li class="fragment">When Bob receives the message, he combines it with the MAC key the same way Alice did</li>
          <li class="fragment">If that function outputs the same MAC, then the message and MAC hasn't been tampered with</li>
        </ul>
        <p class="fragment friendly-aside">&dagger; Generally the ciphertext, known as Encrypt-then-MAC</p>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/alice_and_bob_with_mallory_mac.svg"></p>
        <p>Mallory can modify the ciphertext and<br />MAC to her heart's content.</p>
        <p class="fragment">But because she doesn't know the symmetric<br />key, she can't generate the correct MAC.</p>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/alice_and_bob_with_mallory_mac2.svg"></p>
        <p>So when Bob plugs the message and key into the MAC function, he'll quickly see that the MAC he received doesn't match the MAC he generated.</p>
      </section>

      <section>
        <p><em>You're probably thinking this whole MAC thing might<br /> as well be called a <strong>Magic Authentication Code</strong>.</em></p>
        <div style="font-size: 2em; margin-top: .5em;"><div style="display: inline-block; transform: rotate(-180deg);">&#x1f3a9;</div> &#x1f4a5; &#x2728; &#x2728; &#x1f430;</div>
      </section>

      <section>
        <p><em>How might a function like this work?</em></p>
      </section>

      <section>
        <p>One such method is a <strong>hash-based message authentication code</strong>, or <strong>HMAC</strong>.</p>
      </section>

      <section>
        <p style="font-size: 1.2em;"><em>So, err&hellip; what's a hash?</em></p>
        <div class="fragment friendly-aside"><div style="display: inline-block; font-style: normal; transform: rotate(-180deg);">&#x1f3a9;</div> This rabbit hole just keeps getting deeper! <div style="display: inline-block; font-style: normal; transform: rotate(-180deg);">&#x1f3a9;</div></div>
      </section>

      <section>
        <h2>Hash functions</h2>
        <p><img class="plain" src="images/first-party/hash_function.svg" height="350"></p>
        <p>Cryptographic hash functions take any<br />size input and convert it to a fixed size<br />output called a <strong>hash</strong> or <strong>message digest</strong>.</p>
      </section>

      <section>
        <h2>Hash functions</h2>
        <ul>
          <li class="fragment">Always result in the same size output (typically 128-512 bits), regardless of input size</li>
          <li class="fragment">Sensitive to input changes: a single bit difference in the input should result in a completely different hash</li>
          <li class="fragment">Make it difficult to find two different inputs that result in the same output (<strong>collision resistance</strong>)</li>
          <li class="fragment">Aren't reversible: you can't go from the hash back to the original message</li>
        </ul>
      </section>

      <section>
        <p>What might this look like?</p>
        <div class="pre-box-container command-line">
          <div class="pre-box-row command-line">
            $&nbsp;<span class="fragment" data-autoslide="60">s</span><span class="fragment" data-autoslide="60">h</span><span class="fragment" data-autoslide="60">a</span><span class="fragment" data-autoslide="60">s</span><span class="fragment" data-autoslide="60">u</span><span class="fragment" data-autoslide="60">m</span><span class="fragment" data-autoslide="60">&nbsp;</span><span class="fragment" data-autoslide="60">f</span><span class="fragment" data-autoslide="60">i</span><span class="fragment" data-autoslide="60">r</span><span class="fragment" data-autoslide="60">e</span><span class="fragment" data-autoslide="60">f</span><span class="fragment" data-autoslide="60">o</span><span class="fragment" data-autoslide="200">x</span>
          </div>
          <div class="pre-box-row command-line"><span class="fragment" data-autoslide="1000000000">b93d1da594d1173c53f1dd1fb9dda5af1864c10b</span>
          </div>
        </div>
      </section>

      <section>
        <p style="font-size: 1.2em;"><em>This presentation can read your mind<sup>&dagger;</sup></em></p>
        <p class="fragment friendly-aside" data-fragment-index="1"><em>It knows you're thinking, &ldquo;Ah ha! I've totally got this!&rdquo;</em></p>
        <p class="fragment friendly-aside" style="font-size: .5em !important; margin-top: 4em;" data-fragment-index="1"><sup>&dagger;</sup>Bwahahahahaha! <span style="font-style: normal;">&#x1f606;</span></p>
      </section>

      <section data-transition="fade-out">
        <h3>A brief exercise</h3>
        <p>You run a photo sharing site with a public API:</p>
        <ul>
          <li>Users have two credentials
            <ul>
              <li>A public user id</li>
              <li>A shared secret (key) that only you and they know</li>
            </ul>
          </li>
          <li>Changes are made with HTTP POST requests</li>
          <li>To authenticate the message, the user concatenates their secret key with their message to generate a message authentication code using the cryptographic hash function <strong>MD5</strong></li>
        </ul>
      </section>

      <section data-background-iframe="code/badmd5.html" data-transition="fade-in">
        <p class="fragment popup" style="margin-top: 2.5em !important;"><em>Everything look great?</em></p>
      </section>

      <section>
        <p>Turns out, that piece of code is horribly insecure, due to <strong>length-extension attacks</strong> on many hash functions.</p>
        <ul style="font-size: .9em;">
          <li class="fragment">If you know the value of <span class="mono green">md5('mozilla')</span>, it's easy to calculate <span class="mono green">md5('mozillarules')</span> without knowing the prefix <span class="mono green">'mozilla'</span></li>
          <li class="fragment">So if an attacker knows the value <span class="mono green">md5(secret&amp;key=value)</span>, it's easy for them to calculate <span class="mono green">md5(secret&amp;key=value&amp;key2=value2)</span> without knowing the value of <span class="mono green">'secret'</span></li>
          <li class="fragment">As long as the attacker has one valid signed message, they can forge that message plus any additional parameters they want and it will authenticate</li>
        </ul>
      </section>

      <section>
        <p style="margin-bottom: 1em;">
          <img class="plain" style="margin-right: 2em;" src="images/first-party/alice_sad.svg" height="300">
          <img class="plain" style="margin-right: 2em;" src="images/first-party/bob_sad.svg" height="300">
          <img class="plain" style="margin-right: 2em;" src="images/first-party/eve.svg" height="300">
          <img class="plain" src="images/first-party/mallory_happy.svg" height="300">
        </p>
        <p><em>I did warn you not to write your own crypto!</em></p>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/hmac.svg" height="300"></p>
        <p><em>Just kidding. I know you'd never do something like that.</em></p>
        <p class="fragment"><em>You'd go to your carefully-sourced cryptographic<br />library and use HMAC as instructed.</em></p>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/hmac.svg" height="300"></p>      
        <p>After all, the way they are constructed<sup>&dagger;</sup><br />makes them immune to these attacks.</p>
        <p style="font-size: .75em;"><em><sup>&dagger;</sup>HMAC</em> = H((K ⊕ <em>opad</em>) || H((K ⊕ <em>ipad</em>) || m))</p>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/alice_and_bob_hmac.svg"></p>
        <p>So when Alice sends a message to Bob,<br />she can protect it with HMAC.</p>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/alice_and_bob_hmac.svg"></p>
        <p>The symmetric-key crypto provides <strong>confidentiality</strong>, and HMAC provides <strong>integrity</strong> and <strong>authentication</strong>.</p>
      </section>

      <section>
        <p><em>Just when you thought things couldn't get any better&hellip;</em></p>
      </section>

      <section>
        <p><em>&hellip;they get better!</em> &#x1f60d;</p>
      </section>

      <!-- Begin AEADs -->
      <section id="aeads">
        <h3>AEADs</h3>
        <p class="left">Cryptographers recognized that combining a cipher, block mode, and MAC was <em>really hard and error prone</em>.</p>
        <ul>
          <li class="fragment"><strong>Authenticated Encryption with Associated Data</strong> (AEAD) is a block cipher mode of operation</li>
          <li class="fragment">It combines encryption and decryption with integrity verification</li>
          <li class="fragment">The most common are AES-GCM (AES in Galois/Counter mode) and ChaCha20-Poly1305</li>
          <li class="fragment"><strong>Strongly</strong> preferred over other symmetric ciphers and modes of operation. Use them!</li>
        </ul>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/aead_encrypt.svg" height="350"></p>
        <ul>
          <li class="fragment">Alice takes her plaintext, symmetric key, and some associated data, and inputs them into the AEAD for encryption</li>
          <li class="fragment">The AEAD outputs the ciphertext and an authentication tag</li>
        </ul>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/aead1.svg" height="350"></p>
        <p>She then sends the ciphertext, associated data, and authentication tag to Bob</p>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/aead_decrypt.svg" height="350"></p>
        <ul>
          <li>Bob takes the ciphertext, associated data, and authentication tag and inputs them in the AEAD for decryption</li>
          <li><em>If the authentication is successful</em>, the AEAD outputs the plaintext</li>
        </ul>
      </section>

      <section>
        <h1 style="font-size: 8em;"><strong>?</strong></h1>
      </section>      


      <!-- Let's lead into public-key crypto! -->
      <section>
        <p><em>Unfortunately, symmetric-key cryptography doesn't solve the most persistent of cryptography problems.</em></p>
      </section>

      <section>
        <h3>Key exchange</h3>
        <p>Symmetric-key cryptography becomes impossible<br />to scale as the number of parties grows.</p>
      </section>

      <section>
        <h3>Key exchange</h3>
        <p><img src="images/first-party/alice_and_bob.svg" style="background: none; border: 0; box-shadow: none; margin: 0;" height="320" /></p>
        <p>Remember Alice and Bob?</p>
        <p class="fragment">They still want to have a conversation.</p>
      </section>

      <section>
        <h3>Key exchange</h3>
        <p><img src="images/first-party/alice_and_bob_key.svg" style="background: none; border: 0; box-shadow: none; margin: 0;" height="320" /></p>
        <p>No problem, they met up and exchanged a key.</p>
        <p class="fragment">One key for two parties.</p>
        <p class="fragment friendly-aside">But what happens when we add more parties?</p>
      </section>

      <section>
        <h3>Key exchange</h3>
        <p><img src="images/first-party/alice_and_bob_key_five.svg" style="background: none; border: 0; box-shadow: none; margin: 0;" height="480" /></p>
        <p>With just five parties, we're already up to 10 keys!</p>
      </section>

      <section>
        <h3>Key exchange</h3>
        <table>
          <tr>
            <th>Number of parties</th>
            <th>Number of key pairs</th>
          </tr>
          <tr>
            <td>2</td>
            <td>1</td>
          </tr>
          <tr>
            <td>3</td>
            <td>3</td>
          </tr>
          <tr>
            <td>5</td>
            <td>10</td>
          </tr>
          <tr>
            <td>10</td>
            <td>45</td>
          </tr>
          <tr>
            <td>100</td>
            <td>4950</td>
          </tr>
          <tr>
            <td>1000</td>
            <td>499,500</td>
          </tr>
          <tr>
            <td>US population</td>
            <td>52 quadrillion</td>
          </tr>
          <tr>
            <td>World population</td>
            <td>2.54 x 10<sup>19</sup></td>
          </tr>
        </table>
        <aside class="notes">
          The number of key pairs is (n * n-1) / 2, where n is the number of parties.
        </aside>
      </section>

      <section>
        <h3>Symmetric-key cryptography is difficult to scale.</h3>
        <p class="fragment friendly-aside">So how do we fix this?</p>
      </section>

      <section>
        <h2>Public-key cryptography</h2>
        <p class="fragment"><em>Or asymmetric-key cryptography,<br />if you prefer to think of it that way.</em></p>
      </section>

      <section>
        <h2>Public-key cryptography</h2>
        <p class="left">Public-key cryptography attempts to solve the thorniest issues in symmetric-key cryptography:</p>
        <ul>
          <li class="fragment">Key exchange: How can you get your key safely to the person you want to communicate with?</li>
          <li class="fragment">Key distribution: How can you keep a key safe when you have a large number of parties?</li>
        </ul>
      </section>

      <section>
        <p><img src="images/third-party/Whitfield_Diffie.png"></p>
        <p>In 1976, this guy struck upon a pair of brilliant ideas.</p>
      </section>

      <section>
        <p><em>What if, instead of needing to meet ahead of time to exchange keys, two people could exchange keys remotely?</em></p>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/eve.svg" height="400"></p>
        <p>And our good friend Eve <strong>couldn't</strong><br /> figure out what their key was?</p>
        <p style="font-size: smaller; font-style: oblique;">(Let's all give a hearty welcome to our eavesdropper, Eve!)</p>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/alice_and_bob_key_with_eve_diffie_hellman.svg" height="320"></p>
        <p class="left"><strong>Diffie-Hellman key exchange</strong><sup>&dagger;</sup> (DHE) allows two parties who have had no prior communications to jointly establish a key remotely, even when their method of communication is insecure.</p>
        <p class="fragment friendly-aside">&dagger; This class demonstrates classic DHE, instead of<br />the recommended <a href="#/elliptic-curve-cryptography">Elliptic Curve DHE</a>, which will be covered later</p>
        <aside class="notes">Note that this presentation uses classic DHE, instead of the recommended ECDH for simplicity purposes.</aside>
      </section>

      <section style="padding: 0;" data-transition="slide-in fade-out" data-transition-speed="fast">
        <p style="margin: 0;"><img class="plain" src="images/third-party/Diffie-Hellman_Key_Exchange_with_Eve-1.svg" height="700"></p>
      </section>

      <section style="padding: 0;" data-transition="fade" data-transition-speed="fast">
        <p style="margin: 0;"><img class="plain" src="images/third-party/Diffie-Hellman_Key_Exchange_with_Eve-2.svg" height="700"></p>
      </section>

      <section style="padding: 0;" data-transition="fade" data-transition-speed="fast">
        <p style="margin: 0;"><img class="plain" src="images/third-party/Diffie-Hellman_Key_Exchange_with_Eve-3.svg" height="700"></p>
      </section>

      <section style="padding: 0;" data-transition="fade" data-transition-speed="fast">
        <p style="margin: 0;"><img class="plain" src="images/third-party/Diffie-Hellman_Key_Exchange_with_Eve-4.svg" height="700"></p>
      </section>

      <section style="padding: 0;" data-transition="fade" data-transition-speed="fast">
        <p style="margin: 0;"><img class="plain" src="images/third-party/Diffie-Hellman_Key_Exchange_with_Eve-5.svg" height="700"></p>
      </section>

      <section style="padding: 0;" data-transition="fade-in slide-out" data-transition-speed="fast">
        <p style="margin: 0;"><img class="plain" src="images/third-party/Diffie-Hellman_Key_Exchange_with_Eve-f.svg" height="700"></p>
      </section>

      <section style="padding-top: 0;">
        <table class="diffie">
          <tr>
            <th colspan="2"><img class="plain" src="images/first-party/alice.svg" height="60"></th>
            <th colspan="2"><img class="plain" src="images/first-party/bob.svg" height="60"></th>
            <th colspan="2"><img class="plain" src="images/first-party/eve_sad.svg" height="60"></th>
          </tr>
          <tr>
            <th>Known</th>
            <th>Unknown</th>
            <th>Known</th>
            <th>Unknown</th>
            <th>Known</th>
            <th>Unknown</th>
          </tr>
          <tr class="fragment" data-fragment-index="1">
            <td><span class="blue">p</span> = <span class="blue">23</span>, <span class="blue">g</span> = <span class="blue">5</span></td>
            <td></td>
            <td><span class="blue">p</span> = <span class="blue">23</span>, <span class="blue">g</span> = <span class="blue">5</span></td>
            <td></td>
            <td><span class="blue">p</span> = <span class="blue">23</span>, <span class="blue">g</span> = <span class="blue">5</span></td>
            <td></td>
          </tr>
          <tr class="fragment" data-fragment-index="2">
            <td><span class="red">a</span> = <span class="red">6</span></td>
            <td><span class="red">b</span></td>
            <td><span class="red">b</span> = <span class="red">15</span></td>
            <td><span class="red">a</span></td>
            <td></td>
            <td><span class="red">a</span>, <span class="red">b</span></td>
          </tr>
          <tr class="fragment" data-fragment-index="3">
            <td><span class="blue">A</span> = <span class="blue">g</span><sup class="red">a</sup> mod <span class="blue">p</span></td>
            <td></td>
            <td><span class="blue">B</span> = <span class="blue">g</span><sup class="red">b</sup> mod <span class="blue">p</span></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr class="fragment" data-fragment-index="3">
            <td><span class="blue">A</span> = <span class="blue">5</span><sup class="red">6</sup> mod <span class="blue">23</span> = <span class="blue">8</3></td>
            <td></td>
            <td><span class="blue">B</span> = <span class="blue">5</span><sup class="red">15</sup> mod <span class="blue">23</span> = <span class="blue">19</span></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr class="fragment" data-fragment-index="4">
            <td><span class="blue">B</span> = <span class="blue">19</span></td>
            <td></td>
            <td><span class="blue">A</span> = <span class="blue">8</span></td>
            <td></td>
            <td><span class="blue">A</span> = <span class="blue">8</span>, <span class="blue">B</span> = <span class="blue">19</span></td>
            <td></td>
          </tr>
          <tr class="fragment" data-fragment-index="5">
            <td><span class="red">s</span> = <span class="blue">B</span><sup class="red">a</sup> mod <span class="blue">p</span></td>
            <td></td>
            <td><span class="red">s</span> = <span class="blue">A</span><sup class="red">b</sup> mod <span class="blue">p</span></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr class="fragment" data-fragment-index="5">
            <td><span class="red">s</span> = <span class="blue">19</span><sup class="red">6</sup> mod <span class="blue">23</span> = <span class="red">2</span></td>
            <td></td>
            <td><span class="red">s</span> = <span class="blue">8</span><sup class="red">15</sup> mod <span class="blue">23</span> = <span class="red">2</span></td>
            <td></td>
            <td><span class="red">s</span> = <span class="blue">19</span><sup class="red">a</sup> mod <span class="blue">23</span><br><span class="red">s</span> = <span class="blue">8</span><sup class="red">b</sup> mod <span class="blue">23</span></td>
            <td></td>
          </tr>
          <tr class="fragment" data-fragment-index="6">
            <td><span class="red">s</span> = <span class="red">2</span></td>
            <td></td>
            <td><span class="red">s</span> = <span class="red">2</span></td>
            <td></td>
            <td></td>
            <td><span class="red">s</span></td>
          </tr>
        </table>
        <p style="font-size: .7em; margin: .5em 0;"><span class="blue">Blue</span> values are public, whereas <span class="red">red</span> values are private (secret).</p>
        <ul style="font-size: .6em;">
          <li class="fragment" data-fragment-index="1">Alice and Bob agree upon a public prime base (<span class="blue">g</span>) and a public prime modulus (<span class="blue">p</span>)</li>
          <li class="fragment" data-fragment-index="2">Alice chooses a secret private key (<span class="red">a</span>), and Bob chooses a secret private key (<span class="red">b</span>)</li>
          <li class="fragment" data-fragment-index="3">Alices calculates <span class="blue">g</span><sup class="red">a</sup> mod <span class="blue">p</span>, and Bob calculates <span class="blue">g</span><sup class="red">b</sup> mod <span class="blue">p</span></li>
          <li class="fragment" data-fragment-index="4">Alice sends Bob her public key (<span class="blue">A</span>), and Bob sends Alice her public key (<span class="blue">B</span>)</li>
          <li class="fragment" data-fragment-index="5">Alice calculates <span class="blue">B</span><sup class="red">a</sup> mod <span class="blue">p</span>, and Bob calculates <span class="blue">A</span><sup class="red">b</sup> mod <span class="blue">p</span> to arrive at a shared key (<span class="red">s</span>)</li>
          <li class="fragment" data-fragment-index="6">Since Eve knows neither <span class="red">a</span> nor <span class="red">b</span>, she can't determine the shared key</li>
        </ul>
        <aside class="notes">
          Of course, in reality, the numbers p, a, and b are <strong>much</strong> larger.
        </aside>
      </section>

      <section>
        <p>Alas, Diffie-Hellman key exchange has a fatal flaw.</p>
      </section>

      <section>
        <p><img src="images/first-party/eve.svg" class="plain" height="400">
        <p>While it protects against eavesdroppers like Eve, it doesn't help against someone a bit more&hellip; <em>malicious</em>.</p>
        <aside class="notes">
          Obviously, if we're talking voice, it's a lot easier.  But what if it's a computer?
        </aside>
      </section>

      <section>
        <p><img src="images/first-party/alice_and_bob_key_with_mallory_diffie_hellman_part1.svg" class="plain" height="400"></p>
        <p>What if Mallory sat in the middle of a<br />conversation between Alice and Bob,<br />pretending to be the other person?</p>
      </section>

      <section>
        <p><img src="images/first-party/alice_and_bob_key_with_mallory_diffie_hellman_part2.svg" class="plain" height="400"></p>
        <p>Alice would do her key exchange with Mallory, while Bob would do a different key exchange with Mallory.</p>
      </section>

      <section>
        <p><img src="images/first-party/alice_and_bob_key_with_mallory_diffie_hellman_part3.svg" class="plain" height="400"></p>
        <p>In the end, Alice and Bob would both think that they had securely exchanged keys, but really they would both be talking to Mallory.</p>
      </section>

      <section>
        <p>Alice and Bob are both having perfectly<br />secret conversations with Mallory.</p>
        <p class="fragment" style="padding-top: 2em;">In cryptography, we would say that we have achieved <strong>confidentiality</strong>, but we don't yet have <strong>authenticity</strong>.</p>
      </section>

      <section>
        <p><img src="images/third-party/Whitfield_Diffie.png"></p>
        <p>So what about his other idea?</p>
      </section>

      <section>
        <p><img src="images/first-party/alice_and_bob_key.svg" class="plain"></p>
        <p><em>What if, instead of two people sharing a key...</em></p>
      </section>

      <section>
        <p>
          <img src="images/first-party/public_key_with_text.svg" class="fragment plain" data-fragment-index="1" height="300">
          <img src="images/first-party/private_key_with_text.svg" class="fragment plain" data-fragment-index="2" height="300">
        </p>
        <p><em>...each person had two keys?</em></p>
        <p class="fragment" data-fragment-index="1">A public key that they could give out to anyone.</p>
        <p class="fragment" data-fragment-index="2">And a private key that they kept to themselves.</p>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/public_key_cryptography.svg" height="300"></p>
        <p>And what if that public key could encrypt messages<br />that <em>only</em> the private key could decrypt?</p>
      </section>

      <section>
        <p>Well, it was <a href="http://ieeexplore.ieee.org/xpl/articleDetails.jsp?arnumber=1055638">great idea</a>.</p>
        <p>But he &mdash; nor anybody else at the time &mdash; knew<br />how to make the mathematics work.</p>
        <aside class="notes">
          Technically Clifford Cocks at the GCHQ had figured it out in 1973, but it was classified at the time.
        </aside>
      </section>

      <section>
        <p>Luckily for all of us, a trio of folks by the name of Ron Rivest, Adi Shamir, and Leonard Adleman discovered a way to make it work.</p>
        <p class="fragment friendly-aside">You might know them by their initials: RSA</p>
      </section>

      <section>
        <h2>RSA cryptosystem</h2>
        <p>RSA is based on a one-way mathematical function known as a "trapdoor function." These functions are easy to do in one direction, but difficult to do in the other direction.</p>
        <p class="fragment">More specifically, RSA relies on the difficulty of factoring the multiple of two large prime numbers.</p>
      </section>

      <section>
        <h3>RSA cryptosystem</h3>
        <ul>
          <li>Choose two prime numbers (<span class="red">p</span> = <span class="red">89</span>, <span class="red">q</span> = <span class="red">101</span>). Use these numbers to generate your <em>private key</em>, <span class="red">d</span><sup style="font-size: .8em;">&dagger;</sup></em>.</li>
          <li class="fragment" data-fragment-index="1">Multiply these numbers together (<span class="blue">n</span> = <span class="red">p</span> × <span class="red">q</span> = <span class="blue">8989</span>). This value (along with a few extra bits) is the <em>public key</em>.</li>
          <li class="fragment" data-fragment-index="2">Now think about how you would try to figure out the factors of <span class="blue">n</span>, if you didn't know <span class="red">p</span> and <span class="red">q</span> already.</li>
        </ul>
        <p class="fragment friendly-aside" data-fragment-index="2" style="margin: .2em auto;">Is it divisible by 2? Nope. How about 3? 5? 7? ...</p>
        <ul>
          <li class="fragment" data-fragment-index="3">In reality, <span class="red">p</span> and <span class="red">q</span> are hundreds of digits long, making it infeasible for a computer to determine what the private key is, even knowing the value of <span class="blue">n</span>.</li>
        </ul>
        <p class="fragment friendly-aside">&dagger; For more information on how this is done,<br />see the Wikipedia article on the <a href="https://en.wikipedia.org/wiki/RSA_%28cryptosystem%29">RSA cryptosystem</a>.</p>
      </section>

      <section>
        <p><em>Let's take a look at how RSA encryption<br />works in practice&hellip;</em></p>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/alice_and_bob_with_eve_rsa_part1.svg" height="400"></p>
        <p>First, Alice asks Bob for a copy of his public key.</p>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/alice_and_bob_with_eve_rsa_part2.svg" height="400"></p>
        <p>Once she has Bob's public key,<br />she then encrypts her message with it.</p>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/alice_and_bob_with_eve_rsa_part3.svg" height="400"></p>
        <p>Next, Alice sends the ciphertext to Bob.</p>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/alice_and_bob_with_eve_rsa_part4.svg" height="400"></p>
        <p>Finally, Bob decrypts the ciphertext with his private key.</p>
        <p class="fragment friendly-aside">Because Eve doesn't have Bob's private key,<br />she can't decrypt Alice's message.</p>
      </section>

      <section>
        <p>Now with 100 people, we just need 100 public-private key pairs, instead of 4950 shared keys.</p>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/alice_and_bob_with_eve_rsa_signing.svg" height="400"></p>
        <p>Plus, Bob can encrypt a special piece of information with his private key that anybody can decrypt with his public key to assert his identity.</p>
        <p class="fragment">We call this <strong>signing</strong>, but more on that later.</p>
      </section>

      <section>
        <h3>I think it's safe to pack it in.</h3>
        <h3>Cryptography is a solved problem.</h3>
      </section>

      <section>
        <h3><em>Not so fast!</em></h3>
      </section>

      <section>
        <h3>Public-key cryptography</h3>
        <ul>
          <li>Advantages
            <ul>
              <li>Solves the key distribution problem</li>
              <li>Authenticates the origin of messages</li>
            </ul>
          </li>
          <li>Disadvantages
            <ul>
              <li class="fragment">Computationally very slow
                <ul>
                  <li>Hundreds of times slower than symmetric-key crypto</li>
                </ul>
              </li>
              <li class="fragment">Requires very large keys
                <ul>
                  <li>RSA keys are typically 2048 bits</li>
                  <li>AES keys are typically a mere 128-256 bits</li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
        <p class="fragment friendly-aside">This is 16x larger to transmit in addition to being far slower</em>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/alice_and_bob_with_eve_rsa_part5.svg" height="400"></p>
        <p>Also, how <em>does</em> Alice know that she's actually getting Bob's public key when she asks for it?</p>
        <p class="fragment friendly-aside">We'll get to that, but there's a few more<br />concepts we need to understand first!</p>
      </section>

      <section>
        <h2>Digital signatures</h2>
        <p><em>We're finally getting to the good stuff!</em></p>
      </section>

      <section>
        <h3>Digital signatures</h3>
        <p><img class="plain" src="images/first-party/digital_signature1.svg" height="360"></p>
        <p>What if instead of just sending Bob the plain hash, she created a <strong>digital signature</strong> by encrypting the hash with her <em>private key</em> and sent that to Bob?</p>
        <p class="fragment friendly-aside">That's why we called this <strong>signing</strong> from earlier!</p>
        <aside class="notes">
          Why do we encrypt the hash and not the message? RSA encryption is limited in size by its modulus (aka, n = pq, usually 2048 bits these days)
        </aside>
      </section>

      <section>
        <h3>Digital signatures</h3>
        <p><img class="plain" src="images/first-party/digital_signature2.svg" height="360"></p>
        <p>Bob would then decrypt it with Alice's <em>public key</em> to get back to the original hash. He would then compare it to the message's hash to see if it actually came from Alice.</p>
      </section>

      <section>
        <h3>Digital signatures</h3>
        <p><img class="plain" src="images/first-party/digital_signature3.svg" height="360"></p>
        <p>Sure, Mallory could make up her own message and say it was from Alice. But since she doesn't have Alice's private key, she can't create the correct digital signature.</p>
      </section>

      <section>
        <h3>Digital signatures</h3>
        <p><img class="plain" src="images/first-party/digital_signature4.svg" height="360"></p>
        <p>So when Bob tries to decrypt the digital signature with Alice's public key, it would produce a pile of gibberish that doesn't match the correct one!</p>
      </section>

      <section style="padding: 0;">
        <h4>Digital signatures</h4>
        <p><img class="plain" src="images/first-party/digital_signature5.svg" height="300"></p>
        <p class="left">Of course, if Mallory could forge a message that produced the same hash as Alice's message, she could just reuse Alice's digital signature.</p>
        <p class="fragment left">But because hash functions are <em>collision resistant</em>, Mallory can't do that either!</p>
        <p class="fragment friendly-aside">No wonder Mallory looks so grumpy!</p>
      </section>

      <section>
        <h3>Digital signatures</h3>
        <p><img class="plain" src="images/first-party/digital_signature2.svg" height="360"></p>
        <p>Plus, since <em>only</em> Alice is able to create the proper digital signature, she can't deny that she created the message.</p>
        <p>In cryptography, we call this <strong>non-repudiation</strong>.</p>
      </section>

      <section>
        <h3>Let's take a look at a<br /><span class="friendly-aside">(somewhat simplified)</span> cryptosystem...</h3>
      </section>

      <section style="padding: 0;" data-transition="slide-in fade-out">
        <div style="height: 540px;"><img class="plain" src="images/first-party/digital_signature6-1.svg"></p></div>
        <p>First, Alice takes her message and<br />encrypts it with Bob's public key.</p>
      </section>

      <section style="padding: 0;" data-transition="fade" data-transition-speed="fast">
        <div style="height: 540px;"><img class="plain" src="images/first-party/digital_signature6-2.svg"></p></div>
        <p>Next, she creates a hash of the ciphertext, and encrypts it with her private key, creating a digital signature.</p>
      </section>

      <section style="padding: 0;" data-transition="fade" data-transition-speed="fast">
        <div style="height: 540px;"><img class="plain" src="images/first-party/digital_signature6-3.svg"></p></div>
        <p>She then sends the encrypted message<br />and the digital signature to Bob.</p>
      </section>

      <section style="padding: 0;" data-transition="fade" data-transition-speed="fast">
        <div style="height: 540px;"><img class="plain" src="images/first-party/digital_signature6-4.svg"></p></div>
        <p>Bob takes the encrypted message from Alice,<br />and decrypts it with his private key.</p>
      </section>

      <section style="padding: 0;" data-transition="fade" data-transition-speed="fast">
        <div style="height: 540px;"><img class="plain" src="images/first-party/digital_signature6-5.svg"></p></div>
        <p>To verify the message came from Alice, he creates a hash of the ciphertext, just as Alice did.</p>
      </section>

      <section style="padding: 0;" data-transition="fade" data-transition-speed="fast">
        <div style="height: 540px;"><img class="plain" src="images/first-party/digital_signature6-6.svg"></p></div>
        <p>Bob then takes the digital signature<br />and decrypts it with Alice's public key.</p>
      </section>

      <section style="padding: 0;" data-transition="fade" data-transition-speed="fast">
        <div style="height: 540px;"><img class="plain" src="images/first-party/digital_signature6-f.svg"></p></div>
        <p>If the two hashes match,<br />he knows the message came from Alice.</p>
      </section>

      <section style="padding: 0;" data-transition="fade" data-transition-speed="fast">
        <div style="height: 540px;"><img class="plain" src="images/first-party/digital_signature6-f.svg"></p></div>
        <p>We have <strong>confidentiality</strong>, because the message was encrypted with Bob's public key.</p>
      </section>

      <section style="padding: 0;" data-transition="fade" data-transition-speed="fast">
        <div style="height: 540px;"><img class="plain" src="images/first-party/digital_signature6-f.svg"></p></div>
        <p>We have <strong>authentication</strong>, because only someone with Alice's private key could create a signature that would properly decrypt with Alice's public key.</p>
      </section>

      <section style="padding: 0;" data-transition="fade" data-transition-speed="fast">
        <div style="height: 540px;"><img class="plain" src="images/first-party/digital_signature6-f.svg"></p></div>
        <p>And we have <strong>integrity</strong>, because if the ciphertext or digital signature were modified or replaced, then the resulting hashes wouldn't match.</p>
      </section>

      <section style="padding: 0;" data-transition="fade-in slide-out" data-transition-speed="fast">
        <div style="height: 540px;"><img class="plain" src="images/first-party/digital_signature6-f.svg"></p></div>
        <p class="friendly-aside">Not shown: In real-world implementations, we typically create a symmetric key and encrypt the message with that. The symmetric key is then encrypted using the public key of Bob and signed with Alice's private key.</p>
      </section>

      <section>
        <p>Using public-key cryptography and digital<br />signatures gets us a complete cryptosystem.</p>
        <p>But one unsolved problem remains.</p>
        <p class="fragment" data-fragment-index="1"><img class="plain" src="images/first-party/alice_and_bob_with_eve_rsa_is_this_the_right_key.svg"></p>
        <p class="fragment" data-fragment-index="1"><em>How does Alice know that she <br />actually has Bob's public key?</em></p>
      </section>

      <section>
        <p>What if I told you that there was a way?</p>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/certificate_bob.svg" height="350"></p>
        <p>What if we created a document about Bob,<br />containing his public key?</p>
        <p class="fragment friendly-aside">It would be kind of like a driver's license, but for cryptography.</p>
      </section>

      <section>
        <p>And what if there was someone that<br />we trusted to verify identities?</p>
        <p class="fragment friendly-aside">Just like how your government verifies your driver's license identity.</p>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/certificate_bob_signed.svg" height="350"></p>
        <p>They could sign Bob's document,<br />verifying that the public key actually<br />belonged to Bob and nobody else.</p>
      </section>

      <section>
        <p>
          <img src="images/first-party/certificate_alice_signed.svg" class="fragment plain" data-fragment-index="1" height="320">
          <img src="images/first-party/certificate_bob_signed.svg" class="fragment plain" data-fragment-index="2" height="320">
          <img src="images/first-party/certificate_eve_signed.svg" class="fragment plain" data-fragment-index="3" height="320">
        </p>
        <p>As long as we trusted them to properly verify<br />the ownership of the public keys, we could<br />let them sign anybody's document&hellip;</p>
        <p class="friendly-aside">
          <span class="fragment" data-fragment-index="1">&hellip;whether it be Alice's</span><span class="fragment" data-fragment-index="2">, Bob's</span><span class="fragment" data-fragment-index="3">, or Eve's.</span>
        </p>
      </section>

      <section>
        <p>This way, we'd only need to find a way to securely acquire a small number of verifier's public keys.</p>
      </section>

      <section>
        <h3>Good news!</h3>
        <p>We call these so-called verifiers<br /><strong>certificate authorities</strong>.</p>
        <p class="fragment">And those documents?<br />Well, they're called <strong>certificates</strong>.</p>
      </section>

      <section>
        <p><img src="images/first-party/pile_of_certificate_authorities.png" height="400"></p>
        <p>Your operating system and browser come preloaded with a collection of certificates that contain the public keys of these certificate authorities (CAs).</p>
      </section>

      <section>
        <p><img src="images/first-party/certificate_chain.png" height="400"></p>
        <p>This is the certificate for www.mozilla.org.</p>
        <p>DigiCert was the certificate authority<br /> that issued the certificate.</p>
      </section>

      <section>
        <p>Certificate authorities have a<br />number of responsibilities:</p>
        <ul style="margin: 1em 2.5em;">
          <li class="fragment">Verifying the ownership of a key pair</li>
          <li class="fragment">Signing digital certificates</li>
          <li class="fragment">Issuing records about signed certificates</li>
          <li class="fragment">Revoking certificates when the private key becomes compromised</li>
        </ul>
      </section>

      <section>
        <p>Let's take a look at an actual certificate&hellip;</p>
      </section>

      <section style="padding: 0;">
    <pre style="font-size: .4em; margin-top: 0; padding: 1em;"><span class="fragment highlight-current-red" data-fragment-index="1">Serial Number: 04:e4:eb:1e:7f:8c:51:09:db:bf:0c:1c:7f:41:16:91</span>
<span class="fragment highlight-current-red" data-fragment-index="2">Issuer: C=US, O=DigiCert Inc, OU=digicert.com, CN=DigiCert High Assurance EV CA-1</span>
<span class="fragment highlight-current-red" data-fragment-index="3">Validity:
    Not Before: Dec  2 00:00:00 2013 GMT
    Not After : Dec  7 12:00:00 2015 GMT</span>
Subject: C=US, ST=CA, L=Mountain View, O=Mozilla Foundation, CN=<span class="fragment highlight-current-red" data-fragment-index="4">www.mozilla.org</span>
<span class="fragment highlight-current-red" data-fragment-index="5">Subject Public Key Info:
    Public Key Algorithm: rsaEncryption
        Public-Key: (2048 bit)
        Modulus:
            00:b8:71:c1:e0:d1:87:20:8d:bc:56:6e:16:ad:21:
            63:64:de:58:33:46:c4:06:e5:5b:3d:cc:1b:c0:10:
                       [...]
        Exponent: 65537 (0x10001)</span>
X509v3 extensions:
    X509v3 Subject Alternative Name:
        DNS:<span class="fragment highlight-current-red" data-fragment-index="4">www.mozilla.org</span>, DNS:<span class="fragment highlight-current-red" data-fragment-index="4">mozilla.org</span>
    <span class="fragment highlight-current-red" data-fragment-index="6">X509v3 Key Usage:
        Digital Signature, Key Encipherment,
        TLS Web Server Authentication, TLS Web Client Authentication</span>
    <span class="fragment highlight-current-red" data-fragment-index="7">X509v3 CRL Distribution Points:
        URI:http://crl3.digicert.com/evca1-g4.crl</span>

<span class="fragment highlight-current-red" data-fragment-index="8">Signature Algorithm: sha1WithRSAEncryption
     19:e3:3a:a0:e8:3e:82:7f:dc:ad:56:f3:eb:b1:5c:b0:73:37:
     6e:cf:df:51:08:f5:0b:36:17:dc:f8:a4:1e:df:95:8e:aa:47:
                       [...]</span></pre>
        <div style="display: table;">
          <span style="vertical-align: top;">
            <ul style="font-size: .7em;">
              <li class="fragment" data-fragment-index="1"><span class="fragment highlight-current-red" data-fragment-index="1">A serial number that the CA hasn't<br />used for any prior certificate</span></li>
              <li class="fragment" data-fragment-index="2"><span class="fragment highlight-current-red" data-fragment-index="2">The CA that issued the certificate</span></li>
              <li class="fragment" data-fragment-index="3"><span class="fragment highlight-current-red" data-fragment-index="3">When the certificate is valid for</span></li>
              <li class="fragment" data-fragment-index="4"><span class="fragment highlight-current-red" data-fragment-index="4">Who the certificate is valid for</span></li>
            </ul>
          </span>
          <span style="vertical-align: top;">
            <ul style="font-size: .7em; margin-left: 1.5em;">
              <li class="fragment" data-fragment-index="5"><span class="fragment highlight-current-red" data-fragment-index="5">The public key</span></li>
              <li class="fragment" data-fragment-index="6"><span class="fragment highlight-current-red" data-fragment-index="6">What the certificate is valid for</span></li>
              <li class="fragment" data-fragment-index="7"><span class="fragment highlight-current-red" data-fragment-index="7">Where to check certificate revokation</span></li>
              <li class="fragment" data-fragment-index="8"><span class="fragment highlight-current-red" data-fragment-index="8">The CA's digital signature</span></li>
            </ul>
          </span>
        </div>
      </section>

      <section>
        <p><img src="images/first-party/certificate_chain2.png" height="350"></p>
        <p>If you were paying attention, you may have noticed that there are two certificates listed above www.mozilla.org in what is called the <strong>certificate chain</strong>.
      </section>

      <section>
        <p><img src="images/first-party/certificate_chain_root.png" height="350"></p>
        <p>The top-level certificate is the <strong>root certificate</strong>.</p>
        <p>This is the certificate your browser comes bundled with.</p>
      </section>

      <section>
        <p><img src="images/first-party/certificate_chain_intermediate.png" height="350"></p>
        <p>The center certificate is the <strong>intermediate certificate</strong>.</p>
        <p>CAs don't sign end-user certificates with their root certificate, as the risk is too high.</p>
      </section>

      <section>
        <p><img src="images/first-party/certificate_chain_root.png" height="350"></p>
        <p><em>If the private key for the root were ever compromised, every certificate the CA had issued would instantly become invalid when trust in the public key was revoked.</em></p>
        <aside class="notes">
          This is because the browsers and OS makers would have to remove that root, instantly causing distrust in all certs issued by them.
        </aside>
      </section>

      <section>
        <p><img src="images/first-party/certificate_chain_intermediate.png" height="350"></p>
        <p>Instead, CAs create an intermediate key pair and certificate, and sign that with the root certificate.</p>
        <p>This intermediate CA then issues all end-user certificates. It's periodically replaced as technology progresses.</p>
      </section>

      <section>
        <p><img src="images/first-party/certificate_chain_leaf.png" height="350"></p>
        <p>Finally, you have the <strong>end-entity (EE)</strong> or <strong>leaf certificate</strong>.</p>
        <p>This is the certificate that identifies<br />an individual or organization.</p>
      </section>

      <section>
        <p>This whole system of trust, registration, certificates, chains, authorities, and revocation is collectively known as the <strong>public key infrastructure</strong>, or <strong>PKI</strong>.</p>
      </section>

      <section>
        <p>Now that we've got a strong grasp of all the cryptographic primitives, let's walk through the most important implementation.</p>
      </section>

      <section>
        <h2>Transport Layer Security</h2>
        <p class="left">Transport Layer Security (TLS), previously known as Secure Sockets Layer (SSL), is the protocol used by applications to communicate securely across a network.</p>
        <p class="left">It's the protocol that protects our web browsing, emails, instant messages, and much more.</p>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/tls1.svg" height="350"></p>
        <p>First, Alice sends Bob a random number and the list of cipher suites that she supports.</p>
        <p class="fragment">A <strong>cipher suite</strong> is a combination of key exchange, authentication, encryption, and message authentication.</p>
        <p class="fragment friendly-aside">Feast your eyes: ECDHE-RSA-AES128-GCM-SHA256</p>
        <aside class="notes">We'll talk about MACs later on.</aside>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/tls2.svg" height="350"></p>
        <p>Bob then selects a different random number and chooses a cipher suite, from Alice's options.</p>
        <p>He'll also generate his Diffie-Hellman parameters, if that cipher suite uses DH for key exchange.</p>
        <p class="friendly-aside">These random numbers are used later in key generation to ensure that an attacker can't just replay Alice's messages, in a <strong>replay attack</strong>.</p>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/tls3.svg" height="350"></p>
        <p>He then takes both random numbers and the public Diffie-Hellman parameters and signs them with the private key for his certificate, to create a digital signature.</p>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/tls4.svg" height="250"></p>
        <p>He then sends Alice:</p>
        <ul>
          <li class="fragment">His chosen random number</li>
          <li class="fragment">His choice of cipher suite, from Alice's options</li>
          <li class="fragment">His digital certificate and its certificate chain</li>
          <li class="fragment"><span class="blue">p</span>, <span class="blue">g</span>, and <span class="blue">g</span><sup class="red">b</sup> mod <span class="blue">p</span> = <span class="blue">B</span></li>
          <li class="fragment">A digital signature created from the random numbers and DH parameters</li>
        </ul>
      </section>

      <section style="padding: 0;" data-transition="slide-in fade-out">
        <div style="height: 500px;"><p style="margin-top: 0;"><img class="plain" src="images/first-party/tls5-1.svg"></p></div>
        <p>First, Alice takes Bob's certificate (sans digital signature) and creates a hash of it.</p>
      </section>

      <section style="padding: 0;" data-transition="fade" data-transition-speed="fast">
        <div style="height: 500px;"><p style="margin-top: 0;"><img class="plain" src="images/first-party/tls5-2.svg"></p></div>
        <p>Then, she takes the digital signature in the certificate and decrypts it with the intermediate CA's public key.</p>
      </section>

      <section style="padding: 0;" data-transition="fade-in slide-out" data-transition-speed="fast">
        <div style="height: 500px;"><p style="margin-top: 0;"><img class="plain" src="images/first-party/tls5-3-f.svg"></p></div>
        <p>If the two hashes match, she knows that the certificate was signed by the intermediate CA.</p>
      </section>

      <section style="padding: 0;" data-transition="slide-in fade-out" data-transition-speed="fast">
        <div style="height: 500px;"><p style="margin-top: 0;"><img class="plain" src="images/first-party/tls5-4.svg"></p></div>
        <p>She repeats this process for every certificate in the chain until reaching the one signed by the root CA's public key.</p>
        <p class="friendly-aside">Remember: this key came bundled with her browser!</p>
      </section>

      <section style="padding: 0;" data-transition="fade-in slide-out" data-transition-speed="fast">
        <div style="height: 500px;"><p style="margin-top: 0;"><img class="plain" src="images/first-party/tls5-5-f.svg"></p></div>
        <p>If the two hashes match, she knows that the certificate chain is valid and Bob's public key actually belongs to Bob: the CA confirmed it with its digital signature.</p>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/tls6.svg" height="400"></p>
        <p>Now Alice just needs to verify that she's talking to Bob, and not just somebody with Bob's certificate.</p>
        <p class="fragment friendly-aside">Remember, since certificates are public,<br />everybody has access to Bob's certificate.</p>
      </section>

      <section style="padding: 0; vertical-align: top;" data-transition="slide-in fade-out" data-transition-speed="default">
        <div style="height: 400px;"><p><img class="plain" src="images/first-party/tls7-1.svg" height="400"></p></div>
        <p>First, Alice takes the random numbers and DH parameters that &ldquo;Bob&rdquo; sent and hashes them.</p>
      </section>

      <section style="padding: 0; vertical-align: top;" data-transition="fade" data-transition-speed="fast">
        <div style="height: 400px;"><p><img class="plain" src="images/first-party/tls7-2.svg" height="400"></p></div>
        <p>Then she takes the digital signature that &ldquo;Bob&rdquo; also sent, and decrypts it with the public key in Bob's certificate.</p>
      </section>

      <section style="padding: 0;" data-transition="fade-in slide-out" data-transition-speed="fast">
        <div style="height: 400px; margin-top: 2.03em;"><p><img class="plain" src="images/first-party/tls7-f.svg" height="400"></p></div>
        <p>If the two hashes match, it could only have been created by somebody with Bob's private key.</p>
        <p class="fragment friendly-aside">It's Bob, people!! Bob generated that signature! <span style="font-style: normal;">&#x1f602;</span></p>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/tls8.svg" height="400"></p>
        <p>Since <span class="blue">p</span> and <span class="blue">q</span> are already chosen, Alice just needs to choose her private DH parameter.</p>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/tls9.svg" height="250"></p>
        <p>Alice then sends Bob: <span class="blue">g</span><sup class="red">a</sup> mod <span class="blue">p</span> = <span class="blue">A</span>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/tls10.svg" height="350"></p>
        <ul>
          <li>Alice calculates <span class="blue">B</span><sup class="red">a</sup> mod <span class="blue">p</span> = <span class="red"><strong>s</strong></span></li>
          <li>Bob calculates <span class="blue">A</span><sup class="red">b</sup> mod <span class="blue">p</span> = <span class="red"><strong>s</strong></span></li>
        </ul>
        <p>They use <span class="red"><strong>s</strong></span> and the random numbers<br />to create a master secret which they use to<br /> generate a bunch of shared symmetric keys!</p>
      </section>

      <section>
        <p>
          <img src="images/first-party/key_alice.svg" class="plain" height="200">
          <img src="images/first-party/key_bob.svg" class="fragment plain"  data-fragment-index="1"height="200">
          <img src="images/first-party/key_alice_mac.svg" class="fragment plain" data-fragment-index="2" height="200">
          <img src="images/first-party/key_bob_mac.svg" class="fragment plain" data-fragment-index="3" height="200">
        </p>
        <ul>
          <li>A key that Alice uses to encrypt messages to Bob</li>
          <li class="fragment" data-fragment-index="1">A key that Bob uses to encrypt messages to Alice</li>
          <li class="fragment" data-fragment-index="2">A key that Alice uses for generating MACs for Bob</li>
          <li class="fragment" data-fragment-index="3">A key that Bob uses for generating MACs for Alice</li>
        </ul>
        <p class="fragment friendly-aside">Don't hyperventilate! We'll get to message authentication codes in a bit!</p>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/tls11.svg" height="350"></p>
        <p>Now they simply begin communicating with their symmetric keys, using the cipher and mode of operation specified in the chosen cipher suite.</p>
        <p class="fragment friendly-aside">But before they do that, they must verify that their previous conversation, known as a <strong>handshake</strong>, wasn't a complete farce!</p>
      </section>

      <section data-transition="slide-in fade-out" data-transition-speed="fast">
        <p><img class="plain" src="images/first-party/tls12-1.svg" height="350"></p>
        <p style="height: 3.9em;">Now that they've arrived at their keys, Alice takes their entire previous conversation and hashes it.</p>
        <aside class="notes">She also includes "client finished" -- Bob includes "server finished"</aside>
      </section>

      <section data-transition="fade-in slide-out" data-transition-speed="fast">
        <p><img class="plain" src="images/first-party/tls12-f.svg" height="350"></p>
        <p>She then combines it with the master secret<br />and the message &ldquo;client finished&rdquo; and<br />encrypts it with her encryption key.</p>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/tls13.svg" height="400"></p>
        <p>She then takes this encrypted &ldquo;finished&rdquo; message<br />and sends it over to Bob.</p>
      </section>

      <section style="padding: 0;" data-transition="slide-in fade-out">
        <div style="height: 450px;"><p style="margin-top: 0;"><img class="plain" src="images/first-party/tls14-1.svg"></p></div>
        <p>Bob takes encrypted &ldquo;finished&rdquo; message<br />and decrypts it with Alice's encryption key.</p>
      </section>

      <section style="padding: 0;" data-transition="fade" data-transition-speed="fast">
        <div style="height: 450px;"><p style="margin-top: 0;"><img class="plain" src="images/first-party/tls14-2.svg"></p></div>
        <p>At the same time, he takes the handshake he<br />believes they had and hashes it, as Alice did.</p>
      </section>

      <section style="padding: 0;" data-transition="fade-in slide-out" data-transition-speed="fast">
        <div style="height: 450px; margin-top: 1.05em;"><p style="margin-top: 0;"><img class="plain" src="images/first-party/tls14-f.svg"></p></div>
        <p>If the two &ldquo;finished&rdquo; messages match, he knows that<br />their handshake hadn't been tampered with.</p>
        <p class="fragment friendly-aside">This prevents someone from replacing the<br />cipher suite choices with something very weak.</p>
      </section>

      <section data-transition="fade-in slide-out" data-transition-speed="fast">
        <p><img class="plain" src="images/first-party/tls15-f.svg" height="350"></p>
        <p>Bob then encrypts the hash of their handshake, the master secret and the message &ldquo;server finished&rdquo; and<br />encrypts it with his encryption key.</p>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/tls16.svg" height="400"></p>
        <p>He then sends his version of the encrypted<br />&ldquo;finished&rdquo; message over to Alice.</p>
      </section>

      <section style="padding: 0;" data-transition="slide-in fade-out">
        <div style="height: 450px;"><p style="margin-top: 0;"><img class="plain" src="images/first-party/tls17-1.svg"></p></div>
        <p>Alice takes Bob's encrypted &ldquo;finished&rdquo; message<br />and decrypts it with Bob's encryption key.</p>
      </section>

      <section style="padding: 0;" data-transition="fade-in slide-out" data-transition-speed="fast">
        <div style="height: 450px; padding-top: 1.05em;"><p style="margin-top: 0;"><img class="plain" src="images/first-party/tls17-f.svg"></p></div>
        <p>If the hashed handshake and master secret match Bob's &ldquo;finished&rdquo; message, she also knows their handshake hadn't been tampered with.</p>
      </section>

      <section style="padding: 0;">
        <p><img class="plain" src="images/first-party/hmac1.svg" height="380"></p>
        <p>Alice takes her message and combines it with her symmetric MAC key in a special way.</p>
        <p>She then takes that combination, and hashes it. This produces a hash-based message authentication code, or <strong>HMAC</strong>.
        <aside class="notes">HMAC = H((K ⊕ opad) || H((K ⊕ ipad) || m))</aside>
      </section>

      <section style="padding: 0;">
        <p><img class="plain" src="images/first-party/hmac1.svg" height="380"></p>
        <p>Without knowing the symmetric MAC key, you can't produce the same HMAC.</p>
        <p class="fragment friendly-aside">Who are the two people with the symmetric MAC keys?<br />Why, it's our good friends Alice and Bob.</p>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/hmac2.svg" height="380"></p>
        <p>So when she encrypts a message, she sends along the HMAC for that message.</p>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/hmac3.svg" height="380"></p>
        <p>Bob takes the ciphertext and decrypts it, returning back to original plaintext.</p>
      </section>

      <section style="padding: 0;" data-transition="slide-in fade-out">
        <div style="height: 250px;"><p style="margin-top: 0;"><img class="plain" src="images/first-party/hmac4-1.svg"></p></div>
        <p style="height: 3.9em;">Bob then combines it with the symmetric MAC key that only he and Alice have, producing an HMAC.</p>
      </section>

      <section style="padding: 0;" data-transition="fade-in slide-out" data-transition-speed="fast">
        <div style="height: 250px;"><p style="margin-top: 0;"><img class="plain" src="images/first-party/hmac4-f.svg"></p></div>
        <p>If the HMACs match, then he knows the message hasn't been tampered with and that it came from someone else who possesses the symmetric MAC key: Alice!</p>
      </section>

      <section>
        <p><img class="plain" src="images/first-party/hmac.svg" height="300"></p>
        <p>Think of HMACs as a kind of digital signature that you can do with symmetric-key cryptography.</p>
        <p class="fragment friendly-aside" data-fragment-index="1">However, unlike digital signatures, they can only show that the message came from a party who possesses the symmetric key.</p>
        <p class="fragment friendly-aside" data-fragment-index="1">They don't provide authenticity or non-repudiation.</p>
      </section>

      <section>
        <p>Once Alice and Bob are finished communicating, they throw away the symmetric keys and Diffie-Hellman parameters.</p>
        <p class="fragment">This ensures that their conversation can't be decrypted in the future, a feature known as <strong>forward secrecy</strong>.</p>
      </section>

      <section>
        <h3>TLS: Redux</h3>
        <ul style="font-size: .85em;">
          <li class="fragment">Alice and Bob use Diffie-Hellman key exchange to securely exchange symmetric keys across an insecure network</li>
          <li class="fragment">A certificate authority binds a public key to Bob</li>
          <li class="fragment">Bob uses his private key to create a digital signature to prove to Alice that she's talking to him</li>
          <li class="fragment">An encrypted hash ensures that their handshake hasn't been tampered with</li>
          <li class="fragment">Alice and Bob keep their messages confidential by using a symmetric-key cipher</li>
          <li class="fragment">HMACs protect the integrity of their messages</li>
          <li class="fragment">Once the TLS session is over, they both discard their keys to provide forward secrecy</li>
        </ul>
        <p class="fragment friendly-aside">Note: you can use RSA instead of Diffie-Hellman during the handshake,<br />but you lose forward secrecy.</p>
      </section>

      <section>
        <h1 style="font-size: 8em;"><strong>?</strong></h1>
      </section>

      <section>
        <p style="margin-bottom: 2em;"><em>Who here is ready to go write your own cryptography?</em></p>
        <p class="fragment friendly-aside" data-autoslide="2000"><strong>Go on. Raise your hands. <span class="fragment">You know you want to.</span></strong></p>
      </section>

      <section>
        <p style="margin-bottom: 1em;">
          <img class="plain" style="margin-right: 2em;" src="images/first-party/alice_sad.svg" height="300">
          <img class="plain" style="margin-right: 2em;" src="images/first-party/bob_sad.svg" height="300">
          <img class="plain" style="margin-right: 2em;" src="images/first-party/eve.svg" height="300">
          <img class="plain" src="images/first-party/mallory_happy.svg" height="300">
        </p>
        <p><em>Noooooooooooo! It's a trap!</em></p>
      </section>

      <section style="padding-top: 0;">
        <h3>Attacks on cryptography</h3>
        <table style="font-size: .7em;">
          <tr>
            <th>Bad crypto</th>
            <th>Bad implementations</th>
          </tr>
          <tr>
            <td>DES</td>
            <td>BREACH / CRIME</td>
          </tr>
          <tr>
            <td>MD5</td>
            <td>FREAK</td>
          </tr>
          <tr>
            <td>RC4</td>
            <td>Goto Fail</td>
          </tr>
          <tr>
            <td>SHA-1</td>
            <td>Heartbleed</td>
          </tr>
          <tr>
            <td></td>
            <td>Logjam</td>
          </tr>
          <tr>
            <td></td>
            <td>Lucky Thirteen</td>
          </tr>
          <tr>
            <td></td>
            <td>POODLE</td>
          </tr>
          <tr>
            <td></td>
            <td>WEP (Wireless Encryption)</td>
          </tr>
          <tr>
            <td></td>
            <td>Windows LM Hashes</td>
          </tr>
          <tr>
            <td></td>
            <td class="friendly-aside">(and on and on and on and on)</td>
          </tr>
        </table>
        <p>Most vulnerabilities in cryptography are due to people using it incorrectly, and not due to the crypto itself.</p>
        <aside class="notes">
          BREACH: TLS compression, CRIME: HTTP compression
          FREAK: Export downgrade
          Goto Fail: Apple handshake verification failure
          Heartbleed: OpenSSL TLS heartbeat leaks memory contents
          Logjam: Use of standardized and insufficiently-sized DH group sizes
          Lucky Thirteen: Padding oracle / timing side-channel attack on MACs
          POODLE: Padding oracle attack when using CBC in SSL 3.0
          WEP: Insufficiently-sized IV (nonce) in RC4 lead to related key attacks when IV repeats
          Windows LM hashes: Password divisions, lack of salt lead to insufficient key space
        </aside>
      </section>

      <section>
        <p>Even when some of the best cryptographic engineers in the world work on crypto, they can still get it wrong.</p>
        <p class="fragment friendly-aside">Don't make the same mistake: don't write your own crypto!</p>
      </section>

      <section data-transition="fade-out">
        <h3>A brief exercise</h3>
        <p>You run a photo sharing site with a public API:</p>
        <ul>
          <li>Users have two credentials
            <ul>
              <li>A public user id (id)</li>
              <li>A shared secret that only you and they know</li>
            </ul>
          </li>
          <li>Changes are made with HTTP POST requests</li>
          <li>To authenticate the message, the user concatenate their secret key with their message and generate a message authentication code using the cryptographic hash function <strong>MD5</strong></li>
        </ul>
      </section>

      <section data-background-iframe="code/badmd5.html" data-transition="fade-in">
        <p class="fragment popup" style="margin-top: 2.5em !important;"><em>Everything look great?</em></p>
      </section>

      <section>
        <p>Turns out, that piece of code is horribly insecure, due to <strong>length-extension attacks</strong> on SHA-2.</p>
        <ul>
          <li class="fragment">If you know the value of <span class="mono green">md5('mozilla')</span>, it's easy to calculate <span class="mono green">md5('mozillarules')</span> without knowing the prefix <span class="mono green">'mozilla'</span></li>
          <li class="fragment">So if an attacker knows the value <span class="mono green">md5(secret&amp;key=value)</span>, it's easy for them to calculate <span class="mono green">md5(secret&amp;key=value&amp;key2=value2)</span> without knowing the value of <span class="mono green">'secret'</span></li>
          <li class="fragment">As long as the attacker has one valid signed message, they can forge that message plus any additional parameters they want and it will authenticate</li>
        </ul>
      </section>

      <section>
        <section>
          <p style="margin-bottom: 2em;"><em>Should you be expected to know this?</em></p>
          <p class="fragment" style="margin-bottom: 2em;">No, probably not. It's an easy mistake to make, and demonstrates just how easy it is to screw up when you develop your own cryptography.</p>
          <p class="fragment friendly-aside" style="margin-bottom: 2em;">Don't believe me? The developers at Flickr, Vimeo,<br />and many others all made this <a href="http://netifera.com/research/flickr_api_signature_forgery.pdf">exact mistake</a>.</p>
          <p class="fragment friendly-aside"><strong>&darr; P.S. Another example lies below! &darr;</strong></p>
        </section>

        <section data-background-iframe="code/abadtime.html">
          <p class="fragment popup">&darr; <em>How 'bout now?</em> &darr;</p>
        </section>

        <section>
          <p>Woe! This code insecure too, due to a <strong>timing attack</strong>.</p>
          <ul style="font-size: .8em;">
            <li class="fragment">For a given message, send it an HMAC entirely of one character. Do this for each character 0-9 and a-f, such as <span class="mono green">'000&hellip;'</span> and <span class="mono green">'111&hellip;'</span></li>
            <li class="fragment">Measure the time it takes the server to respond; the response that takes the longest matches the first character, as the string equality comparison moved to the second character.</li>
            <li class="fragment">Use a machine with really low latency to the API server, doing the requests a few hundred times for each character to smooth the latency out.</li>
            <li class="fragment">Once you've figured out the first character, move onto the second character. If <span class="mono green">'c'</span> returned the highest latency, try <span class="mono green">'c000&hellip;'</span>, <span class="mono green">'c111&hellip;'</span>, and so on.</li>
            <li class="fragment">Lather, rinse, and repeat until you have the entire HMAC.</li>
          </ul>
        </section>
      </section>

      <section>
        <p style="margin-bottom: 2em;">Cryptography isn't like programming.</p>
        <p>When you make a mistake in your code,<br />you get immediate feedback when it crashes,<br />fails to work, or doesn't compile.</p>
      </section>

      <section>
        <p>With cryptography, you only know you've screwed up when someone makes off with all your data.</p>
        <p class="fragment friendly-aside">Don't write your own crypto!</p>
      </section>

      <section>
        <table style="font-size: .7em;">
          <tr>
            <th>Don'ts</th>
            <th>Do's</th>
          </tr>
          <tr class="fragment">
            <td>Combine primitives yourself</td>
            <td>Use a purpose-built library</td>
          </tr>
          <tr class="fragment">
            <td>Guess at which cipher suites to use</td>
            <td>Use the Mozilla <a href="https://wiki.mozilla.org/Security/Server_Side_TLS">Server Side TLS</a> guidelines</td>
          </tr>
          <tr class="fragment">
            <td>Write your own encryption protocol</td>
            <td>Use TLS and SSH</td>
          </tr>
          <tr class="fragment">
            <td>Review your own cryptosystem</td>
            <td>Have it reviewed by Security Engineering (Richard Barnes, Eric Rescorla)</td>
          </tr>
          <tr class="fragment">
            <td>Skip using crypto because it's too hard</td>
            <td>Contact Enterprise Information Security in #infosec</td>
          </tr>
        </table>
      </section>

      <section>
        <h3>Resources</h3>
        <ul style="font-size: .8em;">
          <li>Links
            <ul>
              <li>Mozilla <a href="https://wiki.mozilla.org/Security/Server_Side_TLS">Server Side TLS</a> guidelines</li>
              <li>Mozilla <a href="https://mozilla.github.io/server-side-tls/ssl-config-generator/">TLS Configuration Generator</a></li>
              <li>Stanford <a href="https://www.coursera.org/course/crypto">Cryptography I Course</a>, by Dan Boneh</li>
              <li>Qualys <a href="https://www.ssllabs.com/ssltest/">SSL Labs TLS Evaluator</a></li>
            </ul>
          </li>
          <li>Resources
            <ul>
              <li>irc.mozilla.org in #security &amp; #infosec</li>
              <li>Richard Barnes (rbarnes) and Eric Rescorla (ekr),<br />for internal Mozilla crypto review</li>
            </ul>
          </li>
          <li>Books
            <ul>
              <li><em>Bulletproof SSL and TLS</em>, by Ivan Ristić</li>
              <li><em>The Code Book</em>, by Simon Singh</li>
              <li><em>Cryptography Engineering</em>, by Ferguson, Schneier, and Kohno</li>
            </ul>
          </li>
        </ul>
      </section>

      <section>
        <h1 style="font-size: 8em;"><strong>?</strong></h1>
      </section>

      <section>
        <section>
          <h3>Miscellaneous<br />&darr; Cryptography Topics &darr;</h3>
        </section>

        <section id="elliptic-curve-cryptography">
          <h3>Elliptic Curve Cryptography</h3>
          <ul>
            <li>Strongest, fastest, and most popular form of asymmetric key cryptography in modern TLS</li>
            <li class="fragment">Based on Diffie-Hellman, but uses <a href="https://www.imperialviolet.org/2010/12/04/ecc.html">elliptic curves</a> instead of exponentiation</li>
            <li class="fragment">Faster and smaller keys for the same levels of security: a 256-bit ECC public key provides comparable security to a 3092-bit RSA public key</li>
            <li class="fragment">Key exchange with Elliptic Curve Diffie-Hellman (ECDHE)</li>
            <li class="fragment">Digital signatures with Elliptic Curve Digital Signature Algorithm (ECDSA)</li>
          </ul>
          <p class="fragment friendly-aside">Most of the demos in this presentation are actually<br />done these days with ECDHE instead of DHE!</p>
        </section>

        <section id="randomness">
          <h3>Randomness</h3>
          <ul style="font-size: .9em;">
            <li>Randomness is heavily used in the creation of keys, IVs, nonces, etc.</li>
            <li class="fragment">Despite all evidence to the contrary, people are predictable</li>
            <li class="fragment">Turns out that computers are too, and it's difficult to properly generate randomness</li>
            <li class="fragment">If your computer is generating poor randomness, your crypto will be predictable and broken</li>
            <li class="fragment">Use a good source of randomness from your operating system or programming library, and initialize it properly</li>
            <li class="fragment">Like with writing your own crypto, don't write your own random number generator</li>
          </ul>
        </section>
      </section>

      <!-- Definitions below -->
      <section>
        <section>
          <h2>Cryptographic Terminology</h2>
          <p><em>Post-presentation, reference definitions belooooooow!</em></p>
          <h2>&darr;</h2>
        </section>

        <section>
          <dl>
            <dt>Cryptography</dt>
            <dd>Practice and study of secure communications in the presence of third parties</dd>
            <dt>Plaintext (cleartext)</dt>
            <dd>Data or text that has not been encrypted</dd>
            <dt>Ciphertext</dt>
            <dd>The result of encryption performed on plaintext</dd>
          </dl>
        </section>

        <section>
          <dl>
            <dt>Algorithm</dt>
            <dd>A self-contained series of instructions that perform a computation</dd>
            <dt>Cipher</dt>
            <dd>An algorithm that performs encryption and decryption</dd>
            <dt>Encryption</dt>
            <dd>Using a cipher to transform plaintext into ciphertext</dd>
            <dt>Decryption</dt>
            <dd>Using a cipher to transform ciphertext into plaintext</dd>
          </dl>
        </section>

        <section>
          <dl>
            <dt>Key</dt>
            <dd>A piece of information known only to one or both parties that is fed into a cipher and determines its output</dd>
            <dt>Key exchange</dt>
            <dd>The process by which two parties agree upon a mutual key or key pair</dd>
            <dt>Key space</dt>
            <dd>The maximum number of possible keys (such as 128 bits, or 2<sup>128</sup>)</dd>
            <dt>Brute-force attack</dt>
            <dd>Attempting decryption with all possible key combinations until the correct key is found</dd>
          </dl>
        </section>

        <section>
          <dl>
            <dt>Cipher suite</dt>
            <dd>Combination of key exchange, authentication, encryption, and message authentication code (MAC)</dd>
            <dt>Cryptographic system (cryptosystem)</dt>
            <dd>A combination of cryptographic algorithms that implement a security service, usually encompassing key generation, encryption, and decryption</dd>
            <dt>Message authentication code (MAC)</dt>
            <dd>A small piece of information used to authenticate a message and to provide protection against tampering</dd>
          </dl>
        </section>

        <section>
          <dl>
            <dt>Cryptanalysis</dt>
            <dd>The study of breaking, weakening, or bypassing cryptosystems</dd>
            <dt>Steganography</dt>
            <dd>Concealing a message (image, file, text, etc.) within another message</dd>
            <dt>Placeholder names</dt>
            <dd>Names such as <em>Alice</em>, <em>Bob</em>, <em>Eve</em> (the eavesdropper), or <em>Mallory</em> (the malicious attacker) used as shorthand when describing cryptosystems</dd>
          </dl>
        </section>
      </section>
      <!-- End definitions -->

      <section>
        <h2>Feedback</h2>
        <ul>
          <li>Issues @ <a href="https://github.com/marumari/crypto-presentation/">gh/marumari/crypto-presentation</a></li>
          <li>IRC @ irc.mozilla.org #infosec (April)</li>
        </ul>
      </section>

    </div>
  </div>

 
  <script>
    // Let's startup reveal.js!
    Reveal.initialize({
      controls: false,
      height: 700,
      history: true,
      margin: .05,
      minScale: .1,
      slideNumber: 'c/t',
      width: 960,

      dependencies: [
        { async: true, src: 'plugin/notes/notes.js' }
      ]
    });
  </script>
</body>
</html>
